import{r as o,j as e,R as ve}from"./react-2c5e04fd.js";import{c as Fe}from"./react-dom-a0a7c348.js";import{G as Z,T as P}from"./@google-9fb8d721.js";import Ge from"openseadragon";import"./scheduler-765c72db.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();var f=(s=>(s.HOME="Home",s.JOB_AID="Job Aid & Atlas",s.CASE_STUDY="Case Study",s.CASE_LIBRARY="Case Library",s.VISUAL_CHALLENGE="Visual Challenge",s.DIAGNOSTIC_PATHWAY="Diagnostic Pathway",s.AI_CASE_GENERATOR="AI Case Generator",s.IMAGE_GALLERIES="Image Galleries",s.ANALYSIS="Analysis Phase",s.DESIGN="Design Phase",s.DEVELOPMENT="Development Phase",s.EVALUATION="Evaluation & Assessment",s.ADMIN="Admin View",s))(f||{});const Ne="pathology_module_users",$=()=>{const s=localStorage.getItem(Ne);return s?JSON.parse(s):{}},te=s=>{localStorage.setItem(Ne,JSON.stringify(s))},He=(s,t,i)=>{if(s.toLowerCase()==="admin")throw new Error("This username is reserved.");const a=$();if(a[s])throw new Error("Username is already taken.");if(Object.values(a).some(r=>r.email===i))throw new Error("Email is already in use.");const n={username:s,passwordHash:t,email:i};return a[s]=n,te(a),{username:s,email:i}},Be=(s,t)=>{if(s.toLowerCase()==="admin"&&t==="admin")return{username:"admin",isAdmin:!0,email:"admin@system.local"};const a=$()[s];if(!a)throw new Error("User not found.");if(a.passwordHash!==t)throw new Error("Incorrect password.");return{username:a.username,email:a.email}},_e=(s,t,i)=>{const a=$(),n=a[s];if(!n)throw new Error("User not found.");if(n.passwordHash!==t)throw new Error("Incorrect current password.");if(t===i)throw new Error("New password cannot be the same as the old password.");n.passwordHash=i,te(a)},Oe=s=>{const t=$(),i=t[s];if(!i)throw new Error("No account found with that username.");const a=`reset-${Math.random().toString(36).substring(2,11)}`,n=Date.now()+36e5;return i.resetToken=a,i.resetTokenExpires=n,te(t),a},Ue=(s,t)=>{const i=$(),a=Object.values(i).find(n=>n.resetToken===s&&n.resetTokenExpires&&n.resetTokenExpires>Date.now());if(!a)throw new Error("Invalid or expired reset token.");a.passwordHash=t,delete a.resetToken,delete a.resetTokenExpires,i[a.username]=a,te(i)},U="pathology_module_currentUser",Re=()=>{const[s,t]=o.useState(null),[i,a]=o.useState(!0);o.useEffect(()=>{try{const c=localStorage.getItem(U);c&&t(JSON.parse(c))}catch(c){console.error("Failed to parse stored user:",c),localStorage.removeItem(U)}a(!1)},[]);const n=o.useCallback((c,m)=>{const d=Be(c,m);return localStorage.setItem(U,JSON.stringify(d)),t(d),d},[]),r=o.useCallback((c,m,d)=>{const u=He(c,m,d);return localStorage.setItem(U,JSON.stringify(u)),t(u),u},[]),l=o.useCallback(()=>{localStorage.removeItem(U),t(null)},[]);return{currentUser:s,login:n,signup:r,logout:l,isLoading:i,isAuthenticated:!!s}},ze=s=>{const[t,i]=o.useState(f.HOME),[a,n]=o.useState(!0),r=o.useCallback(()=>s?`pathology_module_progress_${s}`:null,[s]);o.useEffect(()=>{const c=r();if(c)try{const m=localStorage.getItem(c);m&&Object.values(f).includes(m)?i(m):i(f.HOME)}catch(m){console.error("Failed to load user progress:",m),i(f.HOME)}n(!1)},[s,r]);const l=o.useCallback(c=>{i(c);const m=r();if(m)try{localStorage.setItem(m,c)}catch(d){console.error("Failed to save user progress:",d)}window.scrollTo(0,0)},[r]);return{currentSection:t,handleSectionChange:l,isLoading:a}},$e=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),le=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 10l-3 3"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 3.5v3m0 9.5V19m-3.5-6H4m12 0h-2.5"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 15l2.5 2.5"})]}),W=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),G=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),z=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),We=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.975 5.975 0 0112 15a5.975 5.975 0 012.454-4.638M15 21a6 6 0 00-9-5.197"})}),Ve=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),Ye=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),ce=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),H=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),Je=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),qe=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),ke=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{d:"M12 14l9-5-9-5-9 5 9 5z"}),e.jsx("path",{d:"M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20"})]}),E=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),Ce=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547a2 2 0 00-.547 1.806l.443 2.216a2 2 0 001.022.547l2.387.477a6 6 0 003.86-.517l.318-.158a6 6 0 013.86-.517l2.387-.477a2 2 0 001.022-.547a2 2 0 00.547-1.806l-.443-2.216z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 01-6 0V6a3 3 0 016 0v6z"})]}),Se=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),B=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),de=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),Ke=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-11.667-11.667l3.181 3.183m0 0l-3.181 3.183m0 0l3.181-3.183m0 0l-3.181-3.183"})}),Qe=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),me=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"})}),he=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),Ze=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:s,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"})}),Xe=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:s,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),es=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:s,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286Zm0 13.036h.008v.016h-.008v-.016Z"})}),ss=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:s,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c.331 0 .658-.025.975-.072M12 15c-4.418 0-8-3.134-8-7s3.582-7 8-7 8 3.134 8 7-3.582 7-8 7Zm0 0v-4.5m0 4.5c.331 0 .658-.025.975-.072M12 3c-4.418 0-8 3.134-8 7s3.582 7 8 7 8 3.134 8 7m0 0c.331 0 .658-.025.975-.072M12 3a8.999 8.999 0 0 0-8.716 6.747M12 3c.331 0 .658-.025.975-.072"})}),V=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.06 1.94A10.5 10.5 0 0 1 22.5 12c0 5.798-4.703 10.5-10.5 10.5S1.5 17.798 1.5 12c0-3.35 1.56-6.326 3.94-8.25"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6a.75.75 0 0 1 .75-.75h.75a.75.75 0 0 1 .75.75v.75a.75.75 0 0 1-.75.75h-.75a.75.75 0 0 1-.75-.75V6zM6.75 3.75a.75.75 0 0 1 .75-.75h.75a.75.75 0 0 1 .75.75v.75a.75.75 0 0 1-.75.75h-.75a.75.75 0 0 1-.75-.75V3.75zM9 6.75a.75.75 0 0 1 .75-.75h.75a.75.75 0 0 1 .75.75v.75a.75.75 0 0 1-.75.75h-.75a.75.75 0 0 1-.75-.75V6.75z"})]}),Y=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8.25c-2.063 0-4.053.64-5.682 1.818l-1.06-1.06a.75.75 0 0 0-1.06 1.06l1.06 1.06C4.64 12.447 4 14.437 4 16.5 4 20.089 7.91 23 12 23s8-2.91 8-6.5c0-2.063-.64-4.053-1.818-5.682l1.06-1.06a.75.75 0 1 0-1.06-1.06l-1.06 1.06C16.053 8.89 14.063 8.25 12 8.25z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 1c0 4.625 3.5 6.5 3.5 6.5"})]}),ts=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.25 2.25a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0v-1.5zM13.75 2.25a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0v-1.5zM10.25 20.25a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0v-1.5zM13.75 20.25a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0v-1.5zM21.75 10.25a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5h1.5zM21.75 13.75a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5h1.5zM3.75 10.25a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5h1.5zM3.75 13.75a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5h1.5z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12z"})]}),is=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0zM9 9.56a1.5 1.5 0 0 1 0-2.12m6 2.12a1.5 1.5 0 0 0 0-2.12"})}),ae=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})}),ge=({className:s})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5C7.5 4.5 4.5 7.5 4.5 12s3 7.5 7.5 7.5 7.5-3 7.5-7.5-3-7.5-7.5-7.5z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7.5v9m-4.5-4.5h9"})]}),as=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h.01M12 12h.01M19 12h.01"})}),ue=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),ns={success:{icon:e.jsx(W,{className:"h-5 w-5"}),classes:"bg-green-50 border-green-400 text-green-800"},error:{icon:e.jsx(G,{className:"h-5 w-5"}),classes:"bg-red-50 border-red-400 text-red-800"},info:{icon:e.jsx(z,{className:"h-5 w-5"}),classes:"bg-sky-50 border-sky-400 text-sky-800"}},S=({type:s,title:t,children:i,className:a=""})=>{const n=ns[s];return e.jsxs("div",{className:`p-4 border-l-4 rounded-r-lg flex items-start space-x-3 ${n.classes} ${a}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:n.icon}),e.jsxs("div",{children:[t&&e.jsx("h3",{className:"font-bold text-sm mb-1",children:t}),e.jsx("div",{className:"text-sm",children:i})]})]})},rs=({onSubmit:s,buttonText:t,isLoginView:i})=>{const[a,n]=o.useState(""),[r,l]=o.useState(""),[c,m]=o.useState(""),d=u=>{u.preventDefault(),i?s(a,r):s(a,r,c)};return e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"username",className:"sr-only",children:"Username"}),e.jsx(ce,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"username",name:"username",type:"text",value:a,onChange:u=>n(u.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500 transition shadow-sm bg-white",placeholder:"Username",autoComplete:"username",required:!0})]}),!i&&e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email"}),e.jsx(Je,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"email",name:"email",type:"email",value:c,onChange:u=>m(u.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500 transition shadow-sm bg-white",placeholder:"Email Address",autoComplete:"email",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx(H,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"password",name:"password",type:"password",value:r,onChange:u=>l(u.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500 transition shadow-sm bg-white",placeholder:"Password",autoComplete:i?"current-password":"new-password",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full bg-primary-300 text-slate-900 font-semibold py-3 px-5 rounded-lg hover:bg-primary-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 transition-all duration-200 shadow-md hover:shadow-lg",children:t})]})},os=({onLogin:s,onSignup:t})=>{const[i,a]=o.useState("login_signup"),[n,r]=o.useState(!0),[l,c]=o.useState(null),[m,d]=o.useState(null),[u,p]=o.useState(""),[x,g]=o.useState(""),[w,y]=o.useState(""),[k,C]=o.useState(""),L=(v,N,I)=>{if(c(null),d(null),!v||!N){c("Username and password are required.");return}try{if(n)s(v,N);else{if(!I){c("Email is required for signup.");return}t(v,N,I)}}catch(ie){c(ie.message)}},A=v=>{v.preventDefault(),c(null),d(null);try{const N=Oe(u);d(`A password reset code has been generated. In a real application, this would be sent to your email. For this simulation, your code is: ${N}`),a("reset")}catch(N){c(N.message)}},h=v=>{if(v.preventDefault(),c(null),d(null),w!==k){c("Passwords do not match.");return}try{Ue(x,w),d("Password has been reset successfully. Please log in with your new password."),a("login_signup"),r(!0),p(""),g(""),y(""),C("")}catch(N){c(N.message)}},j=()=>{switch(i){case"forgot":return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"text-left mb-10",children:[e.jsx("h1",{className:"text-3xl font-bold font-serif text-slate-900",children:"Forgot Password"}),e.jsx("p",{className:"mt-2 text-slate-600",children:"Enter your username to begin the reset process."})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"reset-username",className:"sr-only",children:"Username"}),e.jsx(ce,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"reset-username",type:"text",value:u,onChange:v=>p(v.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500 transition shadow-sm bg-white",placeholder:"Username",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full bg-primary-300 text-slate-900 font-semibold py-3 px-5 rounded-lg hover:bg-primary-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 transition-all duration-200 shadow-md hover:shadow-lg",children:"Get Reset Code"})]}),e.jsx("p",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>{a("login_signup"),c(null)},className:"text-sm text-primary-600 hover:underline",children:"Back to Login"})})]});case"reset":return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"text-left mb-10",children:[e.jsx("h1",{className:"text-3xl font-bold font-serif text-slate-900",children:"Reset Your Password"}),e.jsx("p",{className:"mt-2 text-slate-600",children:"Enter the reset code and your new password."})]}),e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"reset-token",className:"sr-only",children:"Reset Code"}),e.jsx(me,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"reset-token",type:"text",value:x,onChange:v=>g(v.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500",placeholder:"Reset Code",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"new-password",className:"sr-only",children:"New Password"}),e.jsx(H,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"new-password",type:"password",value:w,onChange:v=>y(v.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500",placeholder:"New Password",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"confirm-password",className:"sr-only",children:"Confirm New Password"}),e.jsx(H,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"confirm-password",type:"password",value:k,onChange:v=>C(v.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500",placeholder:"Confirm New Password",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full bg-primary-300 text-slate-900 font-semibold py-3 px-5 rounded-lg hover:bg-primary-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 transition-all duration-200 shadow-md hover:shadow-lg",children:"Reset Password"})]})]});case"login_signup":default:return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"text-left mb-10",children:[e.jsx("h1",{className:"text-3xl font-bold font-serif text-slate-900",children:n?"Welcome Back, Resident":"Create Your Account"}),e.jsx("p",{className:"mt-2 text-slate-600",children:n?"Login to continue your progress.":"Sign up to begin your learning journey."})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex border-b border-slate-200",children:[e.jsx("button",{onClick:()=>{r(!0),c(null)},className:`flex-1 py-3 text-sm text-center transition-colors focus:outline-none ${n?"font-semibold text-primary-600 border-b-2 border-primary-600":"text-slate-500 hover:text-slate-700"}`,children:"LOGIN"}),e.jsx("button",{onClick:()=>{r(!1),c(null)},className:`flex-1 py-3 text-sm text-center transition-colors focus:outline-none ${n?"text-slate-500 hover:text-slate-700":"font-semibold text-primary-600 border-b-2 border-primary-600"}`,children:"SIGN UP"})]})}),e.jsx(rs,{onSubmit:L,isLoginView:n,buttonText:n?"Login to Your Session":"Create Account & Start Learning"},n?"login":"signup"),n&&e.jsx("p",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>{a("forgot"),c(null),d(null)},className:"text-sm text-primary-600 hover:underline",children:"Forgot Password?"})}),e.jsx("p",{className:"text-center text-xs text-slate-500 mt-8",children:"Your progress is saved locally in your browser, linked to your username."})]})}};return e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 min-h-screen",children:[e.jsxs("div",{className:"hidden lg:block relative",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:"url('https://images.unsplash.com/photo-1579154204601-01588f351e67?q=80&w=3439&auto=format&fit=crop')"},children:e.jsx("div",{className:"absolute inset-0 bg-slate-900 opacity-60"})}),e.jsxs("div",{className:"relative z-10 flex flex-col justify-center h-full px-12 text-white",children:[e.jsx(ke,{className:"h-12 w-12 text-primary-400 mb-4"}),e.jsx("h1",{className:"text-4xl font-bold font-serif leading-tight",children:"Unlock Your Diagnostic Potential."}),e.jsx("p",{className:"mt-4 text-lg text-slate-300",children:"An interactive learning module designed to elevate your diagnostic skills in granulomatous diseases of the lung."})]})]}),e.jsx("div",{className:"flex flex-col justify-center items-center p-8 sm:p-12 bg-slate-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[l&&e.jsx("div",{className:"mb-4",children:e.jsx(S,{type:"error",children:l})}),m&&e.jsx("div",{className:"mb-4",children:e.jsx(S,{type:"info",children:m})}),j()]})})]})})},J=({section:s,currentSection:t,onClick:i,icon:a})=>{const n=s===t;return e.jsxs("button",{onClick:()=>i(s),className:`w-full flex items-center px-4 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 text-left ${n?"bg-primary-200 text-primary-900 font-bold shadow-lg shadow-primary-500/20":"text-slate-600 hover:bg-slate-200 hover:text-slate-900"}`,children:[e.jsx("div",{className:"mr-3 flex-shrink-0",children:a}),e.jsx("span",{children:s})]})},xe=({currentSection:s,onSectionChange:t,user:i,onLogout:a,onChangePasswordClick:n,className:r})=>{const l=[{section:f.JOB_AID,icon:e.jsx(Se,{className:"h-5 w-5"})},{section:f.CASE_STUDY,icon:e.jsx(le,{className:"h-5 w-5"})},{section:f.CASE_LIBRARY,icon:e.jsx(ue,{className:"h-5 w-5"})},{section:f.VISUAL_CHALLENGE,icon:e.jsx(de,{className:"h-5 w-5"})},{section:f.DIAGNOSTIC_PATHWAY,icon:e.jsx(Ce,{className:"h-5 w-5"})},{section:f.AI_CASE_GENERATOR,icon:e.jsx(B,{className:"h-5 w-5"})},{section:f.IMAGE_GALLERIES,icon:e.jsx(he,{className:"h-5 w-5"})}],c=[{section:f.ANALYSIS,icon:e.jsx(E,{className:"h-5 w-5"})},{section:f.DESIGN,icon:e.jsx(E,{className:"h-5 w-5"})},{section:f.DEVELOPMENT,icon:e.jsx(E,{className:"h-5 w-5"})},{section:f.EVALUATION,icon:e.jsx(E,{className:"h-5 w-5"})}];return e.jsxs("aside",{className:`bg-white border-r border-slate-200/80 p-4 flex flex-col ${r}`,children:[e.jsxs("div",{className:"flex items-center mb-6 px-2 flex-shrink-0",children:[e.jsx(ke,{className:"h-8 w-8 text-primary-600"}),e.jsx("h1",{className:"ml-3 text-lg font-bold font-serif text-slate-800",children:"Pathology Module"})]}),e.jsxs("nav",{className:"flex-1 space-y-4 overflow-y-auto",children:[e.jsx("div",{children:e.jsx(J,{section:f.HOME,currentSection:s,onClick:t,icon:e.jsx($e,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 mt-4",children:"Learning Sections"}),e.jsx("div",{className:"space-y-1",children:l.map(({section:m,icon:d})=>e.jsx(J,{section:m,currentSection:s,onClick:t,icon:d},m))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 mt-4",children:"Instructional Design"}),e.jsx("div",{className:"space-y-1",children:c.map(({section:m,icon:d})=>e.jsx(J,{section:m,currentSection:s,onClick:t,icon:d},m))})]}),i.isAdmin&&e.jsxs("div",{children:[e.jsx("h2",{className:"px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 mt-4",children:"Admin"}),e.jsx("div",{className:"space-y-1",children:e.jsx(J,{section:f.ADMIN,currentSection:s,onClick:t,icon:e.jsx(Qe,{className:"h-5 w-5"})})})]})]}),e.jsx("div",{className:"mt-auto pt-4 border-t border-slate-200",children:e.jsxs("div",{className:"px-4 py-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"h-8 w-8 text-slate-400 flex-shrink-0"}),e.jsxs("div",{className:"ml-3 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 truncate",children:i.username}),e.jsx("p",{className:"text-xs text-slate-500 truncate",children:i.email})]})]}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsxs("button",{onClick:n,title:"Change Password",className:"w-full flex items-center justify-center text-xs px-2 py-1.5 bg-slate-100 text-slate-700 hover:bg-slate-200 hover:text-slate-900 rounded-md font-medium transition-colors",children:[e.jsx(me,{className:"h-4 w-4 mr-1.5"})," Change Password"]}),e.jsx("button",{onClick:a,title:"Logout",className:"flex-shrink-0 p-2 text-slate-600 hover:bg-slate-200/70 hover:text-slate-900 rounded-md transition-colors",children:e.jsx(Ye,{className:"h-5 w-5"})})]})]})})]})},ls=({onMenuClick:s,currentSection:t})=>e.jsxs("header",{className:"md:hidden bg-white shadow-sm sticky top-0 z-20 flex items-center justify-between p-4 border-b border-slate-200",children:[e.jsx("button",{onClick:s,className:"text-slate-600 hover:text-slate-900 p-2 -ml-2","aria-label":"Open navigation menu",children:e.jsx(qe,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-lg font-semibold text-slate-800 truncate",children:t}),e.jsx("div",{className:"w-6"})," "]}),b=ve.forwardRef(({children:s,className:t="",interactive:i=!1,...a},n)=>{const r="bg-white rounded-xl shadow-sm border border-slate-200/80 p-6 md:p-8 mb-8 transition-all duration-300",l=i?"hover:shadow-md hover:border-slate-300/80 hover:-translate-y-0.5 cursor-pointer":"";return e.jsx("div",{ref:n,className:`${r} ${l} ${t}`,...a,children:s})});b.displayName="Card";const pe=({section:s,description:t,icon:i,onClick:a})=>e.jsx("li",{className:"list-none",children:e.jsx(b,{interactive:!0,className:"!mb-0 h-full",onClick:()=>a(s),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-lg bg-primary-100 flex items-center justify-center mr-4",children:e.jsx("div",{className:"text-primary-600",children:i})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold font-serif text-slate-800",children:s}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:t})]})]})})}),fe=({onSectionChange:s})=>{const t=[{section:f.JOB_AID,description:"A quick-reference table comparing high-yield features of Sarcoidosis and Tuberculosis.",icon:e.jsx(Se,{className:"h-5 w-5"})},{section:f.CASE_STUDY,description:"Work through a classic case of Hypersensitivity Pneumonitis with an interactive whole-slide image viewer.",icon:e.jsx(le,{className:"h-5 w-5"})},{section:f.CASE_LIBRARY,description:"Browse a library of AI-organized case studies with integrated histology.",icon:e.jsx(ue,{className:"h-5 w-5"})},{section:f.VISUAL_CHALLENGE,description:"Sharpen your morphologic eye by comparing Sarcoidosis and HP side-by-side on digital slides.",icon:e.jsx(de,{className:"h-5 w-5"})},{section:f.DIAGNOSTIC_PATHWAY,description:"A comprehensive, multi-step quiz that guides you through the differential diagnosis of a wide range of granulomatous diseases.",icon:e.jsx(Ce,{className:"h-5 w-5"})},{section:f.AI_CASE_GENERATOR,description:"Leverage Gemini AI to generate unique, board-style cases and receive instant feedback on your diagnostic skills.",icon:e.jsx(B,{className:"h-5 w-5"})},{section:f.IMAGE_GALLERIES,description:"Browse curated official images and contribute your own finds to the community gallery.",icon:e.jsx(he,{className:"h-5 w-5"})}],i=[{section:f.ANALYSIS,description:"Defining the learner, their knowledge gaps, and the context for learning.",icon:e.jsx(E,{className:"h-5 w-5"})},{section:f.DESIGN,description:"Creating specific, measurable learning objectives based on the analysis.",icon:e.jsx(E,{className:"h-5 w-5"})},{section:f.DEVELOPMENT,description:"Creating the instructional content, media, and activities.",icon:e.jsx(E,{className:"h-5 w-5"})},{section:f.EVALUATION,description:"Measuring your ability to integrate findings and form a diagnosis.",icon:e.jsx(E,{className:"h-5 w-5"})}];return e.jsxs("div",{className:"space-y-12 animate-fade-in",children:[e.jsxs("header",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl sm:text-5xl font-bold font-serif text-slate-900 tracking-tight",children:"Granulomatous Diseases of the Lung"}),e.jsx("p",{className:"mt-4 text-lg text-slate-600 max-w-3xl mx-auto",children:"An Interactive Learning Module for Pathology Residents"})]}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-4",children:"Welcome, Resident!"}),e.jsx("p",{className:"text-slate-600 leading-relaxed",children:"This module is designed to elevate your diagnostic skills in evaluating granulomatous diseases of the lung. The primary challenge in this area is not just identifying a granuloma, but navigating the significant morphologic overlap between different etiologies. Our goal is to move you from simple identification to integrated diagnostic reasoning—a crucial skill for both daily sign-out and board examinations."})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-6 text-center",children:"The Learning Module"}),e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(a=>e.jsx(pe,{...a,onClick:s},a.section))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-6 text-center",children:"About This Project (Instructional Design)"}),e.jsx("p",{className:"text-slate-600 mb-6 text-center max-w-3xl mx-auto",children:"This module was built using the ADDIE model of instructional design. The sections below provide a meta-narrative on how this learning experience was constructed, from initial analysis to final evaluation."}),e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:i.map(a=>e.jsx(pe,{...a,onClick:s},a.section))})]})]})},T=({title:s,subtitle:t,icon:i})=>e.jsx("header",{className:"mb-8 md:mb-12 animate-fade-in",children:e.jsxs("div",{className:"flex items-center",children:[i&&e.jsx("div",{className:"mr-4 text-primary-600",children:i}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold font-serif text-slate-900",children:s}),e.jsx("p",{className:"mt-2 text-md text-slate-500",children:t})]})]})}),Ae="pathology_module_official_images",Ie="pathology_module_community_images",X=()=>{try{const s=localStorage.getItem(Ae);return s?JSON.parse(s):[]}catch(s){return console.error("Failed to parse official images from localStorage:",s),[]}},ye=s=>{try{localStorage.setItem(Ae,JSON.stringify(s))}catch(t){console.error("Failed to save official images to localStorage:",t)}},ee=()=>{try{const s=localStorage.getItem(Ie);return s?JSON.parse(s):[]}catch(s){return console.error("Failed to parse community images from localStorage:",s),[]}},ne=s=>{try{localStorage.setItem(Ie,JSON.stringify(s))}catch(t){console.error("Failed to save community images to localStorage:",t)}},O=async s=>{const t=X(),i=ee(),a=[...t,...i];if(a.length===0||!s)return null;const n=a.map(({id:r,title:l,description:c})=>({id:r,title:l,description:c}));try{const r=new Z({apiKey:void 0}),l=`
      You are an expert pathologist's assistant. Your task is to select the most relevant histology image for a given clinical case description from a provided list of images.
      The context is: "${s}"
      
      Here is a list of available images in JSON format:
      ${JSON.stringify(n)}

      Based on the context, identify the single best image from the list that illustrates the key pathological findings described. The image title and description are your primary clues.
      Respond with a single JSON object containing the ID of the best matching image. The format should be: {"imageId": "the_best_image_id"}. If no image is a good match, respond with {"imageId": null}.
    `,c=await r.models.generateContent({model:"gemini-2.5-flash",contents:l,config:{responseMimeType:"application/json",responseSchema:{type:P.OBJECT,properties:{imageId:{type:P.STRING,nullable:!0}},required:["imageId"]}}}),m=JSON.parse(c.text.trim());return m.imageId&&a.find(u=>u.id===m.imageId)||null}catch(r){return console.error("AI Image Selector failed:",r),null}},je=[{category:"I. Infectious Granulomatous Diseases",subcategories:[{title:"A. Mycobacterial",diseases:[{name:"Mycobacterium tuberculosis",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Caseating granulomas (amorphous, eosinophilic, necrotic centers), composed of epithelioid histiocytes and Langhans-type giant cells, surrounded by a cuff of lymphocytes."]}),links:[{url:"https://www.pathologyatlas.ro/tuberculous-lymphadenitis-granuloma.php",text:"Tuberculous Granuloma - Atlas of Pathology"}],imageUrl:"https://www.pathpedia.com/education/eatlas/histopathology/lymph_nodes/tuberculous_lymphadenitis/tuberculous-lymphadenitis-1.jpeg?Width=800"},{name:"Nontuberculous Mycobacteria (NTM), e.g., M. avium complex (MAC)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," In immunocompromised patients, often ",e.jsx("em",{children:"poorly formed"}),' granulomas or just collections of foamy macrophages (histiocytes) packed with organisms, which stain with AFB. "Hot tub lung" is a form of HP.']}),links:[{url:"https://www.elsevier.es/es-revista-clinics-22-articulo-incidence-mycobacteria-in-pulmonary-granulomatous-S1807593224002412",text:"Incidence of mycobacteria in pulmonary granulomatous lesions"}],imageUrl:"https://www.researchgate.net/profile/Won-Jung-Koh/publication/320504743/figure/fig1/AS:614324225019914@1523477717582/Histopathologic-findings-of-pulmonary-disease-due-to-Mycobacterium-avium-complex-in-a.png"}]},{title:"B. Fungal",diseases:[{name:"Histoplasma capsulatum",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Small, oval yeasts (2-5 μm) found ",e.jsx("em",{children:"within"})," the cytoplasm of macrophages. Best seen on GMS or PAS stains. Can be associated with caseating granulomas."]}),links:[{url:"https://journals.asm.org/doi/10.1128/msphere.00742-20",text:"Histoplasma Species Elicit Distinct Patterns of Pulmonary Inflammation"}],imageUrl:"https://upload.wikimedia.org/wikipedia/commons/8/87/Histoplasmosis_-_interstitial_-_very_high_mag.jpg"},{name:"Blastomyces dermatitidis",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"}),' Large (8-15 μm), round-to-oval yeasts with thick, "double-contoured" walls and characteristic ',e.jsx("strong",{children:"broad-based budding"}),"."]}),links:[{url:"https://www.ncbi.nlm.nih.gov/books/NBK441987/",text:"Blastomycosis - StatPearls (NCBI)"}],imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Blastomycosis_PASD.jpg/1024px-Blastomycosis_PASD.jpg"},{name:"Coccidioides immitis/posadasii",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Very large (30-100 μm), thick-walled ",e.jsx("strong",{children:"spherules"})," which contain smaller ",e.jsx("strong",{children:"endospores"}),". Ruptured spherules elicit a mixed inflammatory (neutrophilic and granulomatous) response."]}),links:[{url:"https://meridian.allenpress.com/aplm/article/130/1/97/459659/Unusual-Forms-of-Immature-Sporulating-Coccidioides",text:"Unusual Forms of Immature Sporulating Coccidioides"}],imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Coccidioidomycosis_spherule.jpg/1024px-Coccidioidomycosis_spherule.jpg"},{name:"Cryptococcus neoformans/gattii",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"}),' Yeasts of variable size (5-15 μm) with prominent polysaccharide capsules that are clear ("halo") on H&E and stain brightly with ',e.jsx("strong",{children:"Mucicarmine"}),'. Often causes a "soap bubble" or gelatinous tissue reaction with minimal inflammation in immunocompromised hosts.']}),links:[{url:"https://commons.wikimedia.org/wiki/File:Cryptococcosis_of_lung_in_patient_with_AIDS._Mucicarmine_stain_962_lores.jpg",text:"Cryptococcosis of lung - Mucicarmine stain (Wikimedia Commons)"}],imageUrl:"https://upload.wikimedia.org/wikipedia/commons/8/8b/Cryptococcosis_of_lung_in_patient_with_AIDS._Mucicarmine_stain_962_lores.jpg"},{name:"Aspergillus spp.",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," In Allergic Bronchopulmonary Aspergillosis (ABPA), features include mucoid impaction of bronchi, abundant eosinophils, Charcot-Leyden crystals, and fungal hyphae (thin, septate, acute-angle branching)."]}),links:[{url:"https://www.imrpress.com/journal/FBL/8/5/10.2741/945",text:"Pathology of allergic bronchopulmonary aspergillosis"}],imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/52/Aspergillus_GMS.jpg/1024px-Aspergillus_GMS.jpg"},{name:"Pneumocystis jirovecii",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"}),' Classically a foamy, eosinophilic ("cotton candy") intra-alveolar exudate. The granulomatous form (rare) shows poorly formed granulomas, often with a "fluffy" eosinophilic necrotic center that reveals the organisms on GMS stain.']}),links:[{url:"https://pmc.ncbi.nlm.nih.gov/articles/PMC4951449/",text:"Unmasking Granulomatous Pneumocystis jirovecii Pneumonia"}],imageUrl:"https://www.researchgate.net/profile/Aurelie-Guinard/publication/305380582/figure/fig1/AS:385803207868417@1468994065221/Histological-findings-of-granulomatous-Pneumocystis-jirovecii-pneumonia-A-Low-power.png"}]},{title:"C. Bacterial (Non-mycobacterial)",diseases:[{name:"Coxiella burnetii (Q Fever)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," The classic (though not pathognomonic) finding is a ",e.jsx("strong",{children:'"doughnut" granuloma'})," or fibrin-ring granuloma: a central lipid vacuole surrounded by a ring of fibrin, epithelioid histiocytes, and other inflammatory cells."]}),links:[{url:"https://www.researchgate.net/publication/231178178_Q_fever_Bone_marrow_characteristic_granuloma",text:"Q fever: Bone marrow characteristic granuloma (ResearchGate)"}],imageUrl:"https://www.researchgate.net/publication/285324529/figure/fig1/AS:668636730249226@1536426966817/Fibrin-ring-granuloma-doughnut-lesion-in-the-bone-marrow-of-a-patient-with-Q-fever.png"},{name:"Nocardia spp.",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," ",e.jsx("strong",{children:"Suppurative granulomas"}),", which are essentially abscesses (collections of neutrophils) surrounded by granulomatous inflammation. The organism is a filamentous, branching, weakly gram-positive rod, best seen on a ",e.jsx("strong",{children:"Modified Acid-Fast"})," stain."]}),links:[{url:"https://sesc.cat/en/granulomatous-suppurative-pneumonia-due-to-nocardia-in-a-calf/",text:"Granulomatous-suppurative pneumonia due to Nocardia"}],imageUrl:"https://sesc.cat/wp-content/uploads/2014/12/SESC-091-14-3.jpg"}]},{title:"D. Parasitic",diseases:[{name:"Dirofilaria immitis",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"}),` A large, round, necrotic granuloma ("coin lesion") with a central, often degenerated, nematode. The organism's internal structures (e.g., thick cuticle) can sometimes be identified.`]}),links:[{url:"https://www.researchgate.net/figure/Histopathological-findings-of-the-pulmonary-nodule-Dirofilaria-immitis-is-present-in-the_fig4_299072502",text:"Histopathological findings of the pulmonary nodule (ResearchGate)"}],imageUrl:"https://www.researchgate.net/publication/299072502/figure/fig4/AS:340989013540869@1458309531853/Histopathological-findings-of-the-pulmonary-nodule-Dirofilaria-immitis-is-present-in-the.png"}]}]},{category:"II. Non-Infectious Granulomatous Diseases",subcategories:[{title:"A. Systemic / Idiopathic",diseases:[{name:"Sarcoidosis",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," The classic non-caseating granuloma. They are well-formed, discrete, and ",e.jsx("strong",{children:'"naked"'})," (i.e., with very little surrounding lymphocytic inflammation). Asteroid bodies and Schaumann bodies can be seen but are not specific."]}),links:[{url:"https://dermnetnz.org/topics/sarcoidosis-pathology",text:"Sarcoidosis pathology - DermNet"}],imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Sarcoid_lung_interstitium.jpg/1024px-Sarcoid_lung_interstitium.jpg"},{name:"Crohn's Disease",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Rare in the lung, but histologically mimics sarcoidosis. Features non-caseating granulomas that may be airway-centered or random. Diagnosis requires a strong clinical history of GI Crohn's disease."]}),links:[{url:"https://pmc.ncbi.nlm.nih.gov/articles/PMC8261598/",text:"Crohn's disease with pulmonary granuloma in a child (PMC)"}],imageUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8261598/bin/CRJ-2021-5573489-g002.jpg"}]},{title:"B. Inhalational / Hypersensitivity",diseases:[{name:"Hypersensitivity Pneumonitis (HP)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," The classic triad is 1) cellular bronchiolitis, 2) chronic interstitial inflammation (lymphoplasmacytic), and 3) ",e.jsx("strong",{children:"poorly formed, non-necrotizing granulomas"})," and/or isolated multinucleated giant cells, often located ",e.jsx("em",{children:"peribronchiolarly"}),"."]}),links:[{url:"https://meridian.allenpress.com/aplm/article/132/2/199/460400/Hypersensitivity-Pneumonitis-Histopathology",text:"Hypersensitivity Pneumonitis: Histopathology - Archives of Pathology"}],imageUrl:"http://www.webpathology.com/slides-100/slide-2-hp-med.jpg"},{name:"Berylliosis (Chronic Beryllium Disease)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Histologically ",e.jsx("em",{children:"indistinguishable"})," from sarcoidosis. Shows well-formed, non-caseating granulomas. The distinction is clinical (history of exposure) and immunological (positive BeLPT)."]}),links:[{url:"https://www.frontiersin.org/journals/immunology/articles/10.3389/fimmu.2020.00474/full",text:"Adaptive Immunity in Pulmonary Sarcoidosis and Chronic Beryllium Disease"}],imageUrl:"https://www.cdc.gov/niosh/topics/beryllium/images/histo.jpg"},{name:"Silicosis",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Features classic ",e.jsx("strong",{children:"silicotic nodules"}),", which are dense, whorled, hyalinized (collagenous) nodules. Under ",e.jsx("strong",{children:"polarized light"}),", they contain numerous, small, brightly birefringent silica crystals."]}),links:[{url:"https://webpath.med.utah.edu/LUNGHTML/LUNG086.html",text:"Lung, silicosis, polarized light microscopic - WebPath"},{url:"https://www.youtube.com/watch?v=PUqOTkKWZR4",text:"Video: Silicosis Histopathology Overview (YouTube)"}],imageUrl:"https://webpath.med.utah.edu/jpeg5/LUNG086.jpeg"},{name:"Talc Granulomatosis (IV drug use)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Features foreign-body giant cells containing plate-like, brightly birefringent ",e.jsx("strong",{children:"talc crystals"})," under ",e.jsx("strong",{children:"polarized light"}),". The granulomas are characteristically perivascular or intravascular."]}),links:[{url:"https://pmc.ncbi.nlm.nih.gov/articles/PMC1860321/",text:"Talc induced pulmonary granulomatosis - (PMC)"}],imageUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1860321/bin/1746-1596-1-11-1-c.jpg"}]},{title:"C. ANCA-Associated Vasculitides",diseases:[{name:"Granulomatosis with Polyangiitis (GPA)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," A triad of vasculitis, (often neutrophilic), ",e.jsx("strong",{children:'"geographic" necrosis'})," (large, map-like, basophilic necrosis), and granulomatous inflammation with palisading histiocytes and giant cells."]}),links:[{url:"https://pmc.ncbi.nlm.nih.gov/articles/PMC11138764/",text:"Pulmonary pathology in vasculitis - (PMC)"}],imageUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11138764/bin/yjbm_77_2_79_F3.jpg"},{name:"Eosinophilic Granulomatosis with Polyangiitis (EGPA)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Necrotizing, ",e.jsx("strong",{children:"eosinophil-rich"})," granulomas (granulomas with central eosinophilic necrosis surrounded by histiocytes) and an eosinophilic vasculitis."]}),links:[{url:"https://www.ncbi.nlm.nih.gov/books/NBK537099/",text:"Eosinophilic Granulomatosis With Polyangiitis - (NCBI)"}],imageUrl:"https://www.pathpresenter.net/casereportsv4/fetch/3b74e64f0b2f153a8174780598710329.jpg?type=1&content_type=1"}]},{title:"D. Drug-Induced",diseases:[{name:"Checkpoint Inhibitors",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Can induce a ",e.jsx("strong",{children:"sarcoid-like reaction"})," with well-formed, non-caseating granulomas, histologically identical to sarcoidosis."]}),links:[{url:"https://www.actasdermo.org/es-translated-article-sarcoid-like-reactions-immune-articulo-S0001731023008645",text:"Sarcoid-like Reactions to Immune Checkpoint Inhibitors"}],imageUrl:"https://www.jto.org/cms/10.1016/j.jtho.2016.11.2223/attachment/2a2a7f52-5011-4099-b1fd-e09fa4968453/gr1.jpg"},{name:"Methotrexate",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," Can cause a hypersensitivity-like reaction. Findings can include non-caseating granulomas (similar to HP), organizing pneumonia, and interstitial inflammation with eosinophils."]}),links:[{url:"https://publications.ersnet.org/content/erj/15/2/373",text:"Methotrexate pneumonitis: review of the literature and histopathological findings"}],imageUrl:"https://erj.ersjournals.com/content/erj/15/2/373/F1.large.jpg"}]},{title:"E. Lymphoproliferative Disorders",diseases:[{name:"Lymphomatoid Granulomatosis (LyG)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," An ",e.jsx("strong",{children:"angiocentric"})," and ",e.jsx("strong",{children:"angiodestructive"}),` infiltrate of atypical lymphoid cells (EBV+ B-cells) mixed with reactive T-cells. The "granulomatosis" part is a misnomer; it's more of an inflammatory, necrotic process that can mimic granulomas.`]}),links:[{url:"https://ajronline.org/doi/10.2214/ajr.175.5.1751335",text:"Lymphomatoid Granulomatosis Radiologic Features and Pathologic Correlations"}],imageUrl:"https://ars.els-cdn.com/content/image/3-s2.0-B9780323377135000219-f021-006-9780323377135.jpg"},{name:"Granulomatous-Lymphocytic Interstitial Lung Disease (GLILD)",features:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Features:"})," A complication of CVID. Features a combination of follicular bronchiolitis (lymphoid follicles with germinal centers along airways) and non-caseating, sarcoid-like granulomas."]}),links:[{url:"https://pmc.ncbi.nlm.nih.gov/articles/PMC4554947/",text:"Granulomatous and Lymphocytic Interstitial Lung Disease (GLILD) - (PMC)"}],imageUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4554947/bin/f1-0060417.jpg"}]}]}],cs=({imageUrl:s,imageName:t,onClose:i})=>(o.useEffect(()=>{const a=n=>{n.key==="Escape"&&i()};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[i]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/75 animate-fade-in",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"image-modal-title",children:e.jsxs("div",{className:"relative p-2 bg-white rounded-lg shadow-xl max-w-4xl max-h-[90vh] w-auto",onClick:a=>a.stopPropagation(),children:[e.jsx("img",{src:s,alt:`Histology of ${t}`,className:"object-contain max-w-full max-h-[85vh] rounded"}),e.jsxs("h2",{id:"image-modal-title",className:"sr-only",children:["Histology image of ",t]}),e.jsx("button",{onClick:i,className:"absolute -top-4 -right-4 bg-white rounded-full p-1 shadow-lg text-slate-600 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors","aria-label":"Close image viewer",children:e.jsx(G,{className:"h-9 w-9"})})]})})),ds=()=>{const[s,t]=o.useState([je[0].category]),[i,a]=o.useState(null),[n,r]=o.useState({}),[l,c]=o.useState(null),m=u=>{t(p=>p.includes(u)?p.filter(x=>x!==u):[...p,u])},d=async(u,p)=>{c(u);const x=`${u}: ${JSON.stringify(p)}`,g=await O(x);r(w=>({...w,[u]:g})),c(null)};return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Histology Link-Out Atlas",subtitle:"A curated collection of high-yield examples for differentiating granulomatous diseases."}),e.jsx("div",{className:"space-y-6",children:je.map(({category:u,subcategories:p})=>{const x=s.includes(u);return e.jsxs("div",{className:"border border-slate-200/80 bg-white rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>m(u),className:"w-full text-left p-4 md:p-5 flex justify-between items-center focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 rounded-lg","aria-expanded":x,children:[e.jsx("h2",{className:"text-xl font-semibold font-serif text-slate-800",children:u}),e.jsx("span",{className:`transform transition-transform duration-200 ${x?"rotate-180":""}`,children:e.jsx("svg",{className:"h-6 w-6 text-slate-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),x&&e.jsx("div",{className:"p-4 md:p-5 border-t border-slate-200/80 space-y-8",children:p.map(({title:g,diseases:w})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-700 mb-4",children:g}),e.jsx("div",{className:"space-y-4",children:w.map(y=>{var A,h;const k=((A=n[y.name])==null?void 0:A.src)??y.imageUrl,C=((h=n[y.name])==null?void 0:h.title)??`Histology of ${y.name}`,L=!!n[y.name];return e.jsx(b,{className:"!mb-0 !p-5 bg-slate-50/50",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start gap-5",children:[k&&e.jsxs("div",{className:"flex-shrink-0 text-center w-32",children:[e.jsxs("button",{onClick:()=>a({url:k,name:y.name}),className:"group relative w-32 h-32 rounded-md overflow-hidden border-2 border-slate-200 hover:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-all duration-200","aria-label":`View histology image for ${y.name}`,children:[e.jsx("img",{src:k,alt:C,className:"w-full h-full object-cover bg-slate-100"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 10h.01"})})}),L&&e.jsx("div",{title:"This image was selected by AI from the gallery",className:"absolute top-1 right-1 bg-primary-500 p-1 rounded-full text-white shadow",children:e.jsx(B,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1.5",children:"Click to enlarge"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-md text-primary-800 mb-2",children:y.name}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed mb-4",children:y.features}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:y.links.map(j=>e.jsxs("a",{href:j.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-primary-600 bg-primary-100 hover:bg-primary-200 hover:text-primary-700 px-3 py-1.5 rounded-md transition-colors inline-flex items-center",children:[j.text,e.jsx("svg",{className:"w-4 h-4 ml-1.5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-4.5 0V6.375c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125-1.125h-4.5A1.125 1.125 0 0110.5 10.5z"})})]},j.url))}),e.jsxs("button",{onClick:()=>d(y.name,y.features),disabled:l===y.name,className:"text-sm font-medium text-slate-600 bg-slate-200 hover:bg-slate-300 hover:text-slate-700 px-3 py-1.5 rounded-md transition-colors inline-flex items-center disabled:opacity-50",children:[e.jsx(B,{className:"h-4 w-4 mr-1.5"}),l===y.name?"Searching...":"Find Image"]})]})]})]})},y.name)})})]},g))})]},u)})}),i&&e.jsx(cs,{imageUrl:i.url,imageName:i.name,onClose:()=>a(null)})]})},M=({dziUrl:s,staticImageUrl:t,altText:i})=>{const a=o.useRef(null);return o.useEffect(()=>{let n=null;return a.current&&s&&(n=Ge({element:a.current,prefixUrl:"https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.1/images/",tileSources:s,animationTime:.5,blendTime:.1,constrainDuringPan:!0,maxZoomPixelRatio:2,minZoomLevel:1,visibilityRatio:1,zoomPerScroll:2,showNavigator:!0,navigatorPosition:"BOTTOM_RIGHT",navigatorHeight:120,navigatorWidth:150})),()=>{n&&n.destroy()}},[s]),s?e.jsx("div",{ref:a,className:"w-full h-64 sm:h-96 bg-black rounded-lg shadow-md openseadragon-container","aria-label":i||"Interactive whole slide image viewer"}):t?e.jsx("div",{className:"w-full h-64 sm:h-96 bg-black rounded-lg shadow-md flex items-center justify-center overflow-hidden openseadragon-container",children:e.jsx("img",{src:t,alt:i||"Pathology slide image",className:"max-w-full max-h-full object-contain rounded-lg"})}):e.jsx("div",{className:"w-full h-64 sm:h-96 bg-black rounded-lg shadow-md flex items-center justify-center openseadragon-container","aria-label":"Image viewer placeholder",children:e.jsx("p",{className:"text-slate-300",children:"No image available"})})},ms=({text:s="Loading..."})=>e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-primary-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-3 text-slate-600",children:s})]}),hs=()=>{const[s,t]=o.useState(!1),[i,a]=o.useState(null),[n,r]=o.useState(!0),l={clinical:"You receive a lung wedge biopsy from a 55-year-old man with a 6-month history of progressive shortness of breath and a dry cough. He is a non-smoker but has kept pigeons in his attic for over 20 years. A chest CT shows diffuse, bilateral ground-glass opacities with centrilobular nodules.",histology:"The biopsy shows a cellular interstitial pneumonia. There are numerous small, poorly-formed granulomas centered on the bronchioles (bronchiolocentric). The granulomas are composed of loose collections of epithelioid histiocytes and multinucleated giant cells. There is no necrosis. The surrounding interstitium is expanded by a dense lymphoplasmacytic infiltrate, and scattered eosinophils are present. You also note foci of organizing pneumonia."};return o.useEffect(()=>{(async()=>{r(!0);const m=`The case is about Hypersensitivity Pneumonitis. ${l.clinical} ${l.histology}`,d=await O(m);a(d),r(!1)})()},[]),e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900",children:"Interactive Case Study"}),e.jsx("p",{className:"mt-2 text-md text-slate-600",children:"Applying knowledge to a clinical scenario."})]}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-800 mb-4",children:`Case: "The Bird Fancier's Cough"`}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 mb-2",children:"Part 1: Clinical & Radiologic Data"}),e.jsx("p",{className:"text-slate-600",children:l.clinical})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 mb-2",children:"Part 2: Histologic Findings"}),e.jsxs("div",{className:"space-y-3",children:[n?e.jsx("div",{className:"w-full h-64 sm:h-96 bg-slate-100 rounded-lg shadow-md flex items-center justify-center",children:e.jsx(ms,{text:"Finding relevant image..."})}):e.jsx(M,{staticImageUrl:i==null?void 0:i.src,altText:(i==null?void 0:i.title)||"AI-selected image for the case study."}),i&&e.jsxs("p",{className:"text-center text-sm text-slate-600 font-semibold italic",children:['AI-selected image from gallery: "',i.title,'"']}),!n&&!i&&e.jsx("div",{className:"bg-sky-50 p-4 rounded-md border border-sky-200 text-sm text-sky-800",children:e.jsx("p",{children:"No relevant image was found in the galleries for this case. You can upload one in the Image Galleries section!"})}),e.jsx("p",{className:"text-slate-600 flex-1 pt-2",children:l.histology})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 mb-2",children:"Part 3: The Diagnostic Task"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Given the integrated clinical, radiologic, and histologic findings, construct a ranked differential diagnosis. Justify your top two choices."}),e.jsx("button",{onClick:()=>t(!s),className:"bg-primary-600 text-white font-medium py-2 px-5 rounded-lg hover:bg-primary-700 transition-colors shadow-sm",children:s?"Hide Expert Answer":"Reveal Expert Answer"}),s&&e.jsxs("div",{className:"mt-4 p-4 bg-slate-50 border border-slate-200 rounded-lg animate-fade-in",children:[e.jsx("h4",{className:"font-bold text-slate-800 mb-2",children:"Expert's Answer:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-700",children:"1. Hypersensitivity Pneumonitis (Subacute/Chronic)"}),e.jsxs("p",{className:"text-slate-600 text-sm",children:[e.jsx("strong",{children:"Justification:"})," This is the leading diagnosis. The clinical history (pigeon keeping), radiology (ground-glass, centrilobular nodules), and histology (cellular interstitial pneumonia, bronchiolocentric distribution, poorly-formed non-necrotizing granulomas) align perfectly."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-orange-700",children:"2. Sarcoidosis"}),e.jsxs("p",{className:"text-slate-600 text-sm",children:[e.jsx("strong",{children:"Justification:"})," This is on the differential but less likely. In sarcoidosis, granulomas are typically well-formed and tight with a lymphangitic distribution, which is discordant with this case."]})]})]})]})]})]})]})]})},Le="pathology_module_cases",Te="pathology_module_case_studies",us=()=>{try{const s=localStorage.getItem(Le);return s?JSON.parse(s):{version:"1.0.0",generated:new Date().toISOString(),cases:{}}}catch(s){return console.error("Failed to parse cases from localStorage:",s),{version:"1.0.0",generated:new Date().toISOString(),cases:{}}}},gs=s=>{try{s.generated=new Date().toISOString(),localStorage.setItem(Le,JSON.stringify(s))}catch(t){console.error("Failed to save cases to localStorage:",t)}},Pe=()=>{try{const s=localStorage.getItem(Te);return s?JSON.parse(s):{version:"1.0.0",generated:new Date().toISOString(),caseStudies:{}}}catch(s){return console.error("Failed to parse case studies from localStorage:",s),{version:"1.0.0",generated:new Date().toISOString(),caseStudies:{}}}},xs=s=>{try{s.generated=new Date().toISOString(),localStorage.setItem(Te,JSON.stringify(s))}catch(t){console.error("Failed to save case studies to localStorage:",t)}},ps=({caseStudy:s,onBack:t})=>e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("button",{onClick:t,className:"mb-6 text-sm font-semibold text-primary-600 hover:text-primary-800 transition-colors",children:"← Back to Case Library"}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-3xl font-bold font-serif text-slate-800",children:s.title}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 mb-6",children:[s.tags.map(i=>e.jsx("span",{className:"bg-slate-100 text-slate-700 text-xs font-medium px-2.5 py-1 rounded-full",children:i},i)),e.jsx("span",{className:"capitalize bg-primary-100 text-primary-800 text-xs font-medium px-2.5 py-1 rounded-full",children:s.difficulty})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-800 mb-2 border-b pb-2",children:"Description"}),e.jsx("p",{className:"text-slate-600",children:s.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-800 mb-2 border-b pb-2",children:"Case Context"}),e.jsx("p",{className:"text-slate-600",children:s.caseContext})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-800 mb-2 border-b pb-2",children:"Learning Objectives"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-slate-600",children:s.learningObjectives.map((i,a)=>e.jsx("li",{children:i},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-800 mb-2 border-b pb-2",children:"Discussion"}),e.jsx("p",{className:"text-slate-600",children:s.discussion})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg text-slate-800 mb-2 text-center",children:"Associated Images"}),s.images.length>0?s.images.map(i=>e.jsxs("div",{children:[e.jsx(M,{staticImageUrl:i.path,altText:i.caption}),e.jsx("p",{className:"text-center text-sm text-slate-600 mt-2 font-semibold italic",children:i.caption})]},i.imageId)):e.jsx("p",{className:"text-center text-slate-500",children:"No images associated with this case."})]})]})]})]}),fs=({cases:s,onSelectCase:t})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(i=>e.jsxs(b,{interactive:!0,className:"!mb-0 h-full flex flex-col",onClick:()=>t(i),children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold font-serif text-slate-800 mb-2",children:i.title}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:i.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-auto pt-4 border-t border-slate-100",children:[i.tags.slice(0,3).map(a=>e.jsx("span",{className:"bg-slate-100 text-slate-700 text-xs font-medium px-2 py-0.5 rounded-full",children:a},a)),e.jsx("span",{className:"capitalize bg-primary-100 text-primary-800 text-xs font-medium px-2 py-0.5 rounded-full",children:i.difficulty})]})]},i.caseId))}),ys=({user:s})=>{const[t,i]=o.useState([]),[a,n]=o.useState(null);return o.useEffect(()=>{const r=Pe();i(Object.values(r.caseStudies))},[]),a?e.jsx(ps,{caseStudy:a,onBack:()=>n(null)}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Case Study Library",subtitle:"Browse a collection of AI-generated and organized case studies.",icon:e.jsx(ue,{className:"h-10 w-10"})}),t.length===0?e.jsx(b,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700",children:"The Library is Empty"}),e.jsx("p",{className:"text-slate-500 mt-2",children:s.isAdmin?"Go to the Admin View to generate case studies from the image galleries.":"No case studies have been generated yet. Please check back later."})]})}):e.jsx(fs,{cases:t,onSelectCase:n})]})},Me="pathology_module_user_data",Ee=()=>{const s=localStorage.getItem(Me);return s?JSON.parse(s):{}},js=s=>{localStorage.setItem(Me,JSON.stringify(s))},_=(s,t,i,a)=>{if(s==="admin")return;const n=Ee(),r=n[s]||{},l=t.replace(/\s+/g,"");t===f.AI_CASE_GENERATOR?(r.AICaseGenerator||(r.AICaseGenerator=[]),r.AICaseGenerator.push(a)):t===f.EVALUATION?r.Evaluation=a:(r[l]||(r[l]={}),r[l][i]=a),n[s]=r,js(n)},bs=()=>Ee(),ws=({user:s})=>{const[t,i]=o.useState(null),[a,n]=o.useState(null),r=p=>{t||(i(p),_(s.username,f.VISUAL_CHALLENGE,"challenge1",{question:"Which slide shows the 'tightly-formed, well-circumscribed' granuloma typical of Sarcoidosis?",selectedAnswer:`Slide ${p}`,isCorrect:p==="B",timestamp:Date.now()}))},l=p=>{a||(n(p),_(s.username,f.VISUAL_CHALLENGE,"challenge2",{question:"Which slide shows the 'lymphangitic distribution' typical of Sarcoidosis?",selectedAnswer:`Slide ${p}`,isCorrect:p==="B",timestamp:Date.now()}))},c="https://openslide.cs.cmu.edu/download/openslide-testdata/Aperio/CMU-1.svs.dzi",m="https://openseadragon.github.io/example-images/aperio/aperio.dzi",d="https://openslide.cs.cmu.edu/download/openslide-testdata/Aperio/CMU-1.svs.dzi",u="https://openseadragon.github.io/example-images/aperio/aperio.dzi";return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Visual Discrimination Challenge",subtitle:"Sharpening your eye for Sarcoidosis vs. Hypersensitivity Pneumonitis."}),e.jsxs(b,{children:[e.jsx("p",{className:"text-slate-600 mb-8 text-center max-w-2xl mx-auto",children:"This activity forces a direct, side-by-side comparison of key visual features. Pan and zoom on each digital slide to find the key features, then make your choice."}),e.jsxs("div",{className:"space-y-12",children:[e.jsxs("div",{className:"pb-8 border-b border-slate-200",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"font-semibold font-serif text-xl text-slate-800",children:"Challenge 1: Granuloma Quality"}),e.jsxs("p",{className:"text-slate-500 mt-1",children:["Which slide shows the ",e.jsx("strong",{children:"'tightly-formed, well-circumscribed'"})," granuloma typical of Sarcoidosis?"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-center mb-2 text-slate-700",children:"Slide A"}),e.jsx(M,{dziUrl:c})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-center mb-2 text-slate-700",children:"Slide B"}),e.jsx(M,{dziUrl:m})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row justify-center gap-4",children:[e.jsx("button",{onClick:()=>r("A"),disabled:!!t,className:"px-6 py-2 bg-white border border-slate-300 rounded-lg font-semibold text-slate-700 hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Select Slide A"}),e.jsx("button",{onClick:()=>r("B"),disabled:!!t,className:"px-6 py-2 bg-white border border-slate-300 rounded-lg font-semibold text-slate-700 hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Select Slide B"})]}),t&&e.jsxs("div",{className:"mt-6 max-w-xl mx-auto",children:[t==="A"&&e.jsx(S,{type:"error",title:"Slide A (Incorrect)",children:"This slide represents a 'poorly-formed' granuloma typical of HP. Notice how the cells are loosely aggregated and blend into the surrounding inflammation."}),t==="B"&&e.jsx(S,{type:"success",title:"Slide B (Correct)",children:"Notice the sharp borders and how the epithelioid histiocytes are tightly packed together. This is a classic 'sarcoidal' granuloma."})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"font-semibold font-serif text-xl text-slate-800",children:"Challenge 2: Architectural Distribution"}),e.jsxs("p",{className:"text-slate-500 mt-1",children:["Which slide shows the ",e.jsx("strong",{children:"'lymphangitic distribution'"})," typical of Sarcoidosis?"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-center mb-2 text-slate-700",children:"Slide A"}),e.jsx(M,{dziUrl:d})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-center mb-2 text-slate-700",children:"Slide B"}),e.jsx(M,{dziUrl:u})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row justify-center gap-4",children:[e.jsx("button",{onClick:()=>l("A"),disabled:!!a,className:"px-6 py-2 bg-white border border-slate-300 rounded-lg font-semibold text-slate-700 hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Select Slide A"}),e.jsx("button",{onClick:()=>l("B"),disabled:!!a,className:"px-6 py-2 bg-white border border-slate-300 rounded-lg font-semibold text-slate-700 hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Select Slide B"})]}),a&&e.jsxs("div",{className:"mt-6 max-w-xl mx-auto",children:[a==="A"&&e.jsx(S,{type:"error",title:"Slide A (Incorrect)",children:"This represents a 'bronchiolocentric' pattern, a key feature of HP. The inflammation is centered on the small airways."}),a==="B"&&e.jsx(S,{type:"success",title:"Slide B (Correct)",children:"This represents a lymphangitic distribution. The granulomas are following the lung's lymphatic drainage routes along the bronchovascular bundles and septa."})]})]})]})]}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-4 text-center",children:"High-Yield Summary"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-slate-500",children:[e.jsx("thead",{className:"text-xs text-slate-700 uppercase bg-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-4 font-semibold rounded-l-lg",children:"Feature"}),e.jsx("th",{scope:"col",className:"px-6 py-4 font-semibold",children:"Sarcoidosis"}),e.jsx("th",{scope:"col",className:"px-6 py-4 font-semibold rounded-r-lg",children:"Hypersensitivity Pneumonitis"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200",children:[e.jsxs("tr",{className:"bg-white",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-slate-900 whitespace-nowrap",children:"Quality"}),e.jsx("td",{className:"px-6 py-4",children:'Tight, Well-Formed, "Naked"'}),e.jsx("td",{className:"px-6 py-4",children:"Loose, Poorly-Formed, Cellular"})]}),e.jsxs("tr",{className:"bg-white",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-slate-900 whitespace-nowrap",children:"Location"}),e.jsx("td",{className:"px-6 py-4",children:"Lymphangitic (along bundles)"}),e.jsx("td",{className:"px-6 py-4",children:"Bronchiolocentric (around airways)"})]})]})]})})]})]})},q={root:{id:"root",phase:1,type:"undetermined",title:"Granuloma Identification & Initial Assessment",description:"Granulomas have been identified on histopathology. Begin with the critical distinction between infectious and non-infectious causes.",options:[{text:"Suspect Infectious Cause",target:"infectious-workup",icon:e.jsx(V,{className:"h-5 w-5"})},{text:"Suspect Non-Infectious Cause",target:"non-infectious-workup",icon:e.jsx(ge,{className:"h-5 w-5"})},{text:"Undetermined - Proceed with Comprehensive Workup",target:"comprehensive-workup",icon:e.jsx(z,{className:"h-5 w-5"})}],recommendations:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Always prioritize exclusion of infectious causes before considering non-infectious etiologies."}),e.jsx("li",{children:"Correlate with clinical presentation: B-symptoms (fever, night sweats, weight loss) suggest infection."}),e.jsx("li",{children:"Review radiologic findings: Tree-in-bud pattern suggests infection; perilymphatic nodules suggest sarcoidosis."})]})},"infectious-workup":{id:"infectious-workup",phase:2,type:"infectious",title:"Infectious Workup",description:"When infection is suspected, perform a systematic evaluation for mycobacterial and fungal organisms using special stains and cultures.",options:[{text:"Mycobacterial Evaluation",target:"mycobacterial-workup",icon:e.jsx(V,{className:"h-5 w-5"})},{text:"Fungal Evaluation",target:"fungal-workup",icon:e.jsx(Y,{className:"h-5 w-5"})},{text:"Other Infectious Agents",target:"other-infectious",icon:e.jsx(ts,{className:"h-5 w-5"})}],recommendations:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Send fresh tissue for routine microbiology (culture & PCR) and histopathology."}),e.jsx("li",{children:"Necrotizing granulomas are most commonly infectious (MTB, NTM, fungi)."}),e.jsx("li",{children:"Consider patient's geographic location and travel history for endemic fungi."})]})},"mycobacterial-workup":{id:"mycobacterial-workup",phase:3,type:"infectious",title:"Mycobacterial Evaluation",description:"Evaluate for Mycobacterium tuberculosis (MTB) and non-tuberculous mycobacteria (NTM) using appropriate stains and molecular tests.",options:[{text:"M. tuberculosis Complex",target:"mtb-workup",icon:e.jsx(V,{className:"h-5 w-5"})},{text:"Non-Tuberculous Mycobacteria (NTM)",target:"ntm-workup",icon:e.jsx(V,{className:"h-5 w-5"})}],recommendations:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Perform Ziehl-Neelsen (ZN) stain and auramine-rhodamine fluorescence staining."}),e.jsx("li",{children:"Send tissue for mycobacterial culture (gold standard) and PCR (e.g., Xpert MTB/RIF)."}),e.jsx("li",{children:"MTB typically shows caseating necrosis; NTM may show histologically identical granulomas."})]})},"mtb-workup":{id:"mtb-workup",phase:4,isTerminal:!0,type:"infectious",title:"Conclusion: M. tuberculosis Complex",description:"Tuberculosis remains a leading cause of granulomatous lung disease worldwide. Diagnosis requires identification of the organism or its DNA.",content:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Diagnostic Criteria for MTB:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Clinical:"})," Endemic exposure, immunosuppression (HIV), active TB contact."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Radiologic:"})," Upper lobe cavitary lesions, tree-in-bud pattern, lymphadenopathy."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Histologic:"})," Caseating (necrotizing) granulomas with Langhans giant cells."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Laboratory:"})," Positive culture or molecular identification (Xpert MTB/RIF) from tissue/sputum."]})]})]}),recommendations:"MTB can mimic other granulomatous diseases. Always confirm with microbiologic studies before initiating treatment. In immunocompromised patients, granulomas may be poorly formed or absent."},"ntm-workup":{id:"ntm-workup",phase:4,isTerminal:!0,type:"infectious",title:"Conclusion: Non-Tuberculous Mycobacteria (NTM)",description:"NTM pulmonary disease is increasingly recognized, especially in patients with structural lung disease.",content:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Diagnostic Criteria for NTM (ATS/IDSA Guidelines):"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Clinical:"})," Pulmonary symptoms, radiologic findings, exclusion of other diagnoses."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Radiologic:"})," Nodular bronchiectasis (especially RML/lingula), fibrocavitary disease."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Special Consideration:"})," Hot Tub Lung (HTL) - hypersensitivity vs. infection to NTM."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Laboratory:"})," Positive NTM cultures from bronchial wash or sputum (≥2) or lung biopsy."]})]})]}),recommendations:"Hot Tub Lung presents with centrilobular nodules and ground-glass opacities, mimicking hypersensitivity pneumonitis. Histology shows non-necrotizing granulomas and cellular bronchiolitis."},"fungal-workup":{id:"fungal-workup",phase:3,type:"infectious",title:"Fungal Evaluation",description:"Fungal infections are common causes of granulomatous lung disease. Geographic variation is critical for diagnosis.",options:[{text:"Endemic Fungi",target:"endemic-fungi",icon:e.jsx(Y,{className:"h-5 w-5"})},{text:"Cryptococcus",target:"cryptococcus",icon:e.jsx(Y,{className:"h-5 w-5"})},{text:"Aspergillus",target:"aspergillus",icon:e.jsx(Y,{className:"h-5 w-5"})}],recommendations:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Perform GMS stain for fungi and examine carefully at both low and high magnification."}),e.jsx("li",{children:"Consider patient's geographic location and travel history for endemic fungi."}),e.jsx("li",{children:"Send tissue for fungal culture and consider serologic testing (antigen/antibody)."})]})},"endemic-fungi":{id:"endemic-fungi",phase:4,isTerminal:!0,type:"infectious",title:"Conclusion: Endemic Fungal Infections",description:"Histoplasma, Blastomyces, and Coccidioides are major endemic fungal causes of granulomatous lung disease.",content:e.jsx("p",{children:"Review the comparison table in the Job Aid & Atlas for details on Histoplasma, Blastomyces, and Coccidioides."}),recommendations:"Histoplasma is the most common overlooked cause of unexplained necrotizing granulomas. Multiple recuts and special stains may be necessary for diagnosis."},cryptococcus:{id:"cryptococcus",phase:4,isTerminal:!0,type:"infectious",title:"Conclusion: Cryptococcosis",description:"Cryptococcus neoformans and Cryptococcus gattii cause granulomatous inflammation, particularly in immunocompromised patients.",content:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Diagnostic Criteria for Cryptococcosis:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Histologic:"})," Narrow-based budding yeast (4-7μm); may show capsule on H&E."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Special Stains:"})," Mucicarmine highlights capsule; Fontana-Masson stains cell wall of capsule-deficient strains."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Laboratory:"})," Serum/BAL cryptococcal antigen (highly sensitive/specific), culture."]})]})]}),recommendations:"Cryptococcus is a common opportunistic infection in patients with sarcoidosis due to their underlying immunosuppression. Always consider in patients with known sarcoidosis who develop new or worsening symptoms."},aspergillus:{id:"aspergillus",phase:4,isTerminal:!0,type:"infectious",title:"Conclusion: Aspergillosis",description:"Aspergillus species rarely cause granulomatous inflammation, except in chronic forms of the disease.",content:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Diagnostic Criteria for Aspergillosis:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Histologic:"})," Septate hyphae with acute-angle branching (45°); rarely forms granulomas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Chronic Forms:"})," Chronic necrotizing aspergillosis (semi-invasive) may show granulomatous inflammation."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Laboratory:"})," Culture, galactomannan antigen, PCR, Aspergillus IgG/IgE."]})]})]}),recommendations:"Allergic bronchopulmonary aspergillosis (ABPA) can cause granulomatous inflammation in the airways, typically in patients with asthma or cystic fibrosis. Look for eosinophilic inflammation and mucus plugs."},"other-infectious":{id:"other-infectious",phase:3,isTerminal:!0,type:"infectious",title:"Conclusion: Other Infectious Agents",description:"Less common infectious causes of granulomatous lung disease include parasites, bacteria, and viruses.",content:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Parasitic:"})," Schistosomiasis, paragonimiasis, strongyloidiasis."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bacterial:"})," Brucellosis, tularemia, nocardiosis, rhodococcus equi."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Viral:"})," Rare, but reported with herpesviruses in immunocompromised patients."]})]}),recommendations:"Always consider travel history and exposure to unusual pathogens when common infectious causes have been excluded. Consultation with infectious disease specialists may be helpful."},"non-infectious-workup":{id:"non-infectious-workup",phase:2,type:"non-infectious",title:"Non-Infectious Workup",description:"After excluding infectious causes, evaluate for non-infectious granulomatous lung diseases. Always correlate with clinical and radiologic findings.",options:[{text:"Sarcoidosis",target:"sarcoidosis-workup",icon:e.jsx(is,{className:"h-5 w-5"})},{text:"Vasculitis",target:"vasculitis-workup",icon:e.jsx(ae,{className:"h-5 w-5"})},{text:"Hypersensitivity Pneumonitis",target:"hypersensitivity-workup",icon:e.jsx(ge,{className:"h-5 w-5"})},{text:"Other Non-Infectious Causes",target:"other-non-infectious",icon:e.jsx(as,{className:"h-5 w-5"})}],recommendations:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Non-infectious causes require a diagnosis of exclusion after thorough infectious workup."}),e.jsx("li",{children:"Clinical-radiologic-pathologic correlation is essential for accurate diagnosis."}),e.jsx("li",{children:"Consider drug-induced sarcoidosis-like reactions (DISR) and malignancy-associated reactions."})]})},"sarcoidosis-workup":{id:"sarcoidosis-workup",phase:3,isTerminal:!0,type:"non-infectious",title:"Conclusion: Sarcoidosis",description:"Sarcoidosis is a multisystem granulomatous disorder of unknown cause. The diagnosis requires clinical-radiologic-pathologic correlation.",content:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Diagnostic Criteria for Sarcoidosis:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Clinical:"})," Multisystem involvement; may present with Löfgren's syndrome or Heerfordt's syndrome."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Radiologic:"})," Bilateral hilar lymphadenopathy, perilymphatic nodules."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Histologic:"})," Well-formed, non-necrotizing granulomas in a lymphangitic distribution."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Laboratory:"})," Elevated ACE level (nonspecific), hypercalcemia, BAL lymphocytosis with CD4:CD8 ratio >3.5."]})]})]}),recommendations:"Sarcoidosis is a diagnosis of exclusion. Always rule out infections and other granulomatous diseases like Berylliosis before making the diagnosis."},"vasculitis-workup":{id:"vasculitis-workup",phase:3,type:"non-infectious",title:"Vasculitis Evaluation",description:"Granulomatosis with polyangiitis (GPA) and eosinophilic granulomatosis with polyangiitis (EGPA) are the primary vasculitides causing granulomatous lung disease.",options:[{text:"Granulomatosis with Polyangiitis (GPA)",target:"gpa-workup",icon:e.jsx(ae,{className:"h-5 w-5"})},{text:"Eosinophilic Granulomatosis with Polyangiitis (EGPA)",target:"egpa-workup",icon:e.jsx(ae,{className:"h-5 w-5"})}],recommendations:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Test for ANCA (c-ANCA/PR3 for GPA, p-ANCA/MPO for EGPA)."}),e.jsx("li",{children:"Look for systemic involvement (renal, skin, nerve, ENT)."}),e.jsx("li",{children:"Consider lung biopsy for definitive diagnosis when possible."})]})},"gpa-workup":{id:"gpa-workup",phase:4,isTerminal:!0,type:"non-infectious",title:"Conclusion: Granulomatosis with Polyangiitis (GPA)",description:"GPA (formerly Wegener granulomatosis) is a necrotizing granulomatous vasculitis affecting small- to medium-sized vessels.",content:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Diagnostic Criteria for GPA:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Clinical:"})," Upper airway (sinusitis, nasal ulcers), lower airway (nodules, cavities), renal (glomerulonephritis)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Radiologic:"})," Pulmonary nodules (often multiple and bilateral), cavities."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Histologic:"})," Necrotizing granulomas, necrotizing vasculitis, geographic necrosis."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Serology:"})," c-ANCA/PR3 positive in 90% of active systemic disease."]})]})]}),recommendations:"Limited forms of GPA may present with only granulomatous inflammation without vasculitis. Always consider infection in the differential, especially when necrosis is present."},"egpa-workup":{id:"egpa-workup",phase:4,isTerminal:!0,type:"non-infectious",title:"Conclusion: Eosinophilic Granulomatosis with Polyangiitis (EGPA)",description:"EGPA (formerly Churg-Strauss syndrome) is an eosinophil-rich, necrotizing granulomatous inflammation often affecting the lungs.",content:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Diagnostic Criteria for EGPA:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Clinical:"})," Asthma, eosinophilia (>1,500/μL), mononeuritis multiplex."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Radiologic:"})," Patchy, migratory pulmonary opacities."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Histologic:"})," Eosinophil-rich inflammation, necrotizing granulomas, vasculitis."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Serology:"})," p-ANCA/MPO positive in ~50% of cases."]})]})]}),recommendations:"EGPA can be difficult to distinguish from chronic eosinophilic pneumonia. The presence of systemic vasculitis or mononeuritis multiplex helps establish the diagnosis."},"hypersensitivity-workup":{id:"hypersensitivity-workup",phase:3,isTerminal:!0,type:"non-infectious",title:"Conclusion: Hypersensitivity Pneumonitis (HP)",description:"HP is an immune-mediated lung disease caused by inhalation of antigens in susceptible individuals.",content:e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Diagnostic Criteria for HP:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Clinical:"})," Exposure to known antigen (birds, mold, hot tubs, etc.)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Radiologic:"})," Centrilobular nodules, ground-glass opacities, mosaic attenuation."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Histologic:"})," Poorly formed, non-necrotizing, airway-centric granulomas; cellular bronchiolitis."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Laboratory:"})," BAL lymphocytosis (>20-30%), serum-specific IgG antibodies (supportive)."]})]})]}),recommendations:"Hot Tub Lung is a distinct entity caused by exposure to Mycobacterium avium complex in hot tubs, presenting with features of both HP and infection."},"other-non-infectious":{id:"other-non-infectious",phase:3,isTerminal:!0,type:"non-infectious",title:"Conclusion: Other Non-Infectious Causes",description:"Several other non-infectious conditions can cause granulomatous lung disease.",content:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Chronic Beryllium Disease (CBD):"})," Histologically identical to sarcoidosis; requires exposure history and positive BeLPT."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Drug-Induced Sarcoidosis-like Reactions (DISR):"})," Caused by checkpoint inhibitors, TNF-α inhibitors, etc."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Malignancy-Associated Granulomas:"})," Sarcoid-like reactions can occur with lymphomas and solid tumors."]})]}),recommendations:"A detailed medication and occupational history is essential to identify potential drug-induced or exposure-related reactions."},"comprehensive-workup":{id:"comprehensive-workup",phase:2,isTerminal:!0,type:"undetermined",title:"Conclusion: Comprehensive Workup Required",description:"When the cause is unclear, a comprehensive workup for both infectious and non-infectious causes is necessary.",content:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Clinical Evaluation:"})," Detailed history including symptoms, exposures, travel, occupation, medications."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Radiologic Evaluation:"})," High-resolution CT to characterize pattern and distribution."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Laboratory Tests:"})," ACE level, ANCA, serum-specific IgG for HP, etc."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Pulmonary Evaluation:"})," Bronchoscopy with BAL, transbronchial or surgical lung biopsy."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Histopathology:"})," H&E with GMS, ZN, and potentially PCR for microorganisms."]})]}),recommendations:"Multidisciplinary discussion (MDD) involving pulmonology, radiology, and pathology is essential for complex cases. When diagnosis remains uncertain, close follow-up and re-biopsy may be necessary."}},vs=({text:s="Loading..."})=>e.jsxs("div",{className:"flex items-center justify-center h-full my-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-primary-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-3 text-slate-600",children:s})]}),Ns=({currentPhase:s,maxPhase:t})=>e.jsx("div",{className:"flex items-center justify-center space-x-2 sm:space-x-4 my-8",children:Array.from({length:t}).map((i,a)=>{const n=a+1,r=n===s,l=n<s;return e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center font-bold border-2 transition-all duration-300
                        ${l?"bg-primary-600 border-primary-600 text-white":""}
                        ${r?"bg-white border-primary-600 text-primary-600":""}
                        ${!r&&!l?"bg-white border-slate-300 text-slate-400":""}
                    `,children:l?e.jsx(W,{className:"h-5 w-5"}):n}),e.jsxs("p",{className:`mt-2 text-xs sm:text-sm font-semibold transition-colors duration-300
                        ${r?"text-primary-600":"text-slate-500"}
                    `,children:["Phase ",n]})]},n)})}),ks=({user:s})=>{const[t,i]=o.useState(["root"]),[a,n]=o.useState({}),[r,l]=o.useState({}),[c,m]=o.useState({}),d=o.useRef(null),u=t[t.length-1],p=q[u];o.useEffect(()=>{const y=async k=>{if(r[k]===void 0&&!c[k]){m(h=>({...h,[k]:!0}));const C=q[k],L=`${C.title}: ${C.description}`,A=await O(L);l(h=>({...h,[k]:A})),m(h=>({...h,[k]:!1}))}};t.forEach(y),d.current&&d.current.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},[t,r,c]);const x=(y,k)=>{n(C=>({...C,[y]:k.text})),i(C=>[...C,k.target]),_(s.username,f.DIAGNOSTIC_PATHWAY,y,{question:q[y].title,selectedAnswer:k.text,isCorrect:!0,timestamp:Date.now()})},g=()=>{i(["root"]),n({}),l({}),m({})},w={infectious:{border:"border-red-500",badgeBg:"bg-red-100",badgeText:"text-red-800"},"non-infectious":{border:"border-primary-500",badgeBg:"bg-primary-100",badgeText:"text-primary-800"},undetermined:{border:"border-amber-500",badgeBg:"bg-amber-100",badgeText:"text-amber-800"}};return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Interactive Diagnostic Algorithm",subtitle:"Navigate the diagnostic process with this interactive decision tree."}),e.jsxs(b,{children:[e.jsx(Ns,{currentPhase:p.phase,maxPhase:4}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("button",{onClick:g,className:"bg-slate-200 text-slate-700 font-semibold py-2 px-5 rounded-lg hover:bg-slate-300 transition-colors flex items-center shadow-sm",children:[e.jsx(Ke,{className:"h-5 w-5 mr-2"}),"Start Over"]})}),e.jsx("div",{className:"space-y-6",children:t.map((y,k)=>{var j,v,N;const C=q[y],L=k===t.length-1,A=w[C.type],h=a[y];return e.jsx("div",{ref:L?d:null,children:e.jsxs(b,{className:`!mb-0 border-l-4 ${A.border} ${L?"":"opacity-80 bg-slate-50"}`,children:[e.jsxs("span",{className:`absolute top-4 right-4 text-xs font-bold px-2.5 py-1 rounded-full ${A.badgeBg} ${A.badgeText}`,children:["Phase ",C.phase]}),e.jsx("h2",{className:"text-xl font-semibold font-serif text-slate-800 mb-2 pr-20",children:C.title}),e.jsx("p",{className:"text-slate-600 mb-4",children:C.description}),c[y]&&e.jsx(vs,{text:"Finding relevant image..."}),r[y]&&e.jsxs("div",{className:"my-4 space-y-2 animate-fade-in",children:[e.jsx(M,{staticImageUrl:(j=r[y])==null?void 0:j.src,altText:(v=r[y])==null?void 0:v.title}),e.jsxs("p",{className:"text-center text-sm text-slate-600 font-semibold italic",children:['AI-selected image from gallery: "',(N=r[y])==null?void 0:N.title,'"']})]}),C.content&&e.jsx("div",{className:"mt-4 text-sm",children:C.content}),C.options&&e.jsx("div",{className:`mt-4 space-y-3 ${L?"":"pointer-events-none"}`,children:C.options.map(I=>e.jsxs("button",{onClick:()=>x(C.id,I),disabled:!L,className:`w-full text-left p-3 border rounded-lg transition-all duration-200 flex items-center font-medium
                                                        ${h===I.text?"bg-primary-600 border-primary-600 text-white shadow-md":"bg-white border-slate-300 hover:bg-slate-100 hover:border-slate-400"}`,children:[I.icon&&e.jsx("span",{className:"mr-3",children:I.icon}),I.text]},I.text))}),(h||C.isTerminal)&&e.jsx("div",{className:"mt-6",children:e.jsx(S,{type:"info",title:"Expert Recommendation",children:C.recommendations})})]})},`${y}-${k}`)})})]})]})},re=({text:s="Generating..."})=>e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-primary-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-3 text-slate-600",children:s})]}),Cs=({user:s})=>{const[t,i]=o.useState(null),[a,n]=o.useState(""),[r,l]=o.useState(null),[c,m]=o.useState(!1),[d,u]=o.useState(!1),[p,x]=o.useState(null),[g,w]=o.useState(null),[y,k]=o.useState(!1);o.useEffect(()=>{t&&(async()=>{k(!0);const j=`Clinical History: ${t.clinicalHistory}. Radiologic Findings: ${t.radiologicFindings}. Histologic Description: ${t.histologicDescription}. Diagnosis: ${t.diagnosis}`,v=await O(j);w(v),k(!1)})()},[t]);const C=async()=>{m(!0),x(null),i(null),l(null),n(""),w(null);try{const h=new Z({apiKey:void 0}),j=`
                You are a pathology professor creating a board-style case study for a resident.
                Generate a unique, realistic case of a granulomatous disease of the lung.
                Do NOT use Sarcoidosis, Tuberculosis, or Hypersensitivity Pneumonitis as the final diagnosis. Pick a less common but important entity.
                Provide a clinical history, radiologic findings, and a detailed histologic description.
                Return the output as a single, minified JSON object with no markdown formatting.
            `,v=await h.models.generateContent({model:"gemini-2.5-pro",contents:j,config:{responseMimeType:"application/json",responseSchema:{type:P.OBJECT,properties:{clinicalHistory:{type:P.STRING},radiologicFindings:{type:P.STRING},histologicDescription:{type:P.STRING},diagnosis:{type:P.STRING}},required:["clinicalHistory","radiologicFindings","histologicDescription","diagnosis"]}}}),N=JSON.parse(v.text.trim());i(N)}catch(h){console.error(h),x("Failed to generate a case. Please try again.")}finally{m(!1)}},L=async()=>{if(!(!t||!a)){u(!0),x(null),l(null);try{const h=new Z({apiKey:void 0}),j=`
                You are a senior pathology attending providing feedback to a resident.
                The case is as follows:
                - Clinical History: ${t.clinicalHistory}
                - Radiologic Findings: ${t.radiologicFindings}
                - Histologic Description: ${t.histologicDescription}
                The final diagnosis is: ${t.diagnosis}.

                The resident's submitted differential diagnosis and justification is: "${a}"

                Your task is to:
                1. First, clearly state the correct final diagnosis.
                2. Evaluate the resident's answer. If they were correct, praise them and highlight why their reasoning was good.
                3. If they were incorrect, gently correct them. Explain why their answer is less likely and what key features from the case they might have missed.
                4. Provide a brief, high-yield summary of the key diagnostic features of the correct entity.
                Keep your tone supportive and educational. Format the response using markdown for clarity (bolding with **text** and newlines).
            `,N=(await h.models.generateContent({model:"gemini-2.5-flash",contents:j})).text.trim();l(N),_(s.username,f.AI_CASE_GENERATOR,`case_${Date.now()}`,{caseData:t,userDx:a,feedback:N,timestamp:Date.now()})}catch(h){console.error(h),x("Failed to get feedback. Please try again.")}finally{u(!1)}}},A=h=>{const j=h.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br />");return e.jsx("div",{className:"prose prose-sm max-w-none prose-slate",dangerouslySetInnerHTML:{__html:j}})};return e.jsxs("div",{className:"animate-fade-in space-y-8",children:[e.jsx(T,{title:"AI-Powered Case Generator",subtitle:"Generate unique cases and get instant feedback from a virtual attending."}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("p",{className:"text-slate-600 mb-4 max-w-lg",children:"Challenge yourself with novel cases on less common entities to broaden your differential diagnosis and sharpen your skills."}),e.jsxs("button",{onClick:C,disabled:c,className:"bg-primary-600 text-white font-semibold py-2.5 px-6 rounded-lg hover:bg-primary-700 transition-colors disabled:bg-slate-300 disabled:text-slate-600 disabled:cursor-not-allowed flex items-center shadow-sm",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),c?"Generating...":"Generate New Case Study"]})]}),c&&e.jsx("div",{className:"mt-4",children:e.jsx(re,{})})]}),p&&e.jsx(S,{type:"error",children:p}),t&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs(b,{children:[e.jsx("h2",{className:"text-xl font-semibold font-serif text-slate-800 mb-3",children:"Clinical History"}),e.jsx("p",{className:"text-slate-600 leading-relaxed",children:t.clinicalHistory})]}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-xl font-semibold font-serif text-slate-800 mb-3",children:"Radiologic Findings"}),e.jsx("p",{className:"text-slate-600 leading-relaxed",children:t.radiologicFindings})]}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-xl font-semibold font-serif text-slate-800 mb-3",children:"Histologic Description"}),y&&e.jsx("div",{className:"my-4",children:e.jsx(re,{text:"Finding relevant image..."})}),g&&e.jsxs("div",{className:"my-4 space-y-2",children:[e.jsx(M,{staticImageUrl:g.src,altText:g.title}),e.jsxs("p",{className:"text-center text-sm text-slate-600 font-semibold italic",children:['AI-selected image from gallery: "',g.title,'"']})]}),e.jsx("p",{className:"text-slate-600 leading-relaxed",children:t.histologicDescription})]}),e.jsxs(b,{children:[e.jsx("h2",{id:"user-dx-heading",className:"text-xl font-semibold font-serif text-slate-800 mb-3",children:"Your Diagnosis"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Provide a ranked differential diagnosis and a brief justification."}),e.jsx("label",{htmlFor:"user-dx-textarea",className:"sr-only",children:"Your Diagnosis and Justification"}),e.jsx("textarea",{id:"user-dx-textarea",name:"userDiagnosis",value:a,onChange:h=>n(h.target.value),rows:5,className:"w-full p-3 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500 transition shadow-sm",placeholder:`e.g., 1. Diagnosis A - because of feature X.
2. Diagnosis B - less likely due to feature Y.`,"aria-labelledby":"user-dx-heading"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:L,disabled:d||!a,className:"bg-green-600 text-white font-semibold py-2.5 px-6 rounded-lg hover:bg-green-700 transition-colors disabled:bg-slate-300 disabled:text-slate-600 disabled:cursor-not-allowed shadow-sm",children:d?"Getting Feedback...":"Submit for Feedback"})}),d&&e.jsx("div",{className:"mt-4",children:e.jsx(re,{text:"Getting feedback..."})})]})]}),r&&e.jsx(b,{className:"bg-slate-50 border-slate-200 animate-fade-in",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center mr-4",children:e.jsx(z,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold font-serif text-slate-800 mb-3",children:"Virtual Attending Feedback"}),e.jsx("div",{className:"text-slate-700 leading-relaxed",children:A(r)})]})]})})]})},Ss=({onUpload:s,showGallerySelector:t=!1})=>{const[i,a]=o.useState(""),[n,r]=o.useState(""),[l,c]=o.useState(null),[m,d]=o.useState(null),[u,p]=o.useState(!1),[x,g]=o.useState("community"),w=o.useCallback(h=>{if(!h.type.startsWith("image/")){d("Please upload a valid image file (e.g., JPG, PNG, GIF).");return}d(null);const j=new FileReader;j.onload=v=>{var N;c((N=v.target)==null?void 0:N.result)},j.readAsDataURL(h)},[]),y=h=>{h.target.files&&h.target.files[0]&&w(h.target.files[0])},k=h=>{if(h.preventDefault(),!l||!i){d("An image and a title are required to submit.");return}s({src:l,title:i,description:n},t?x:"community"),a(""),r(""),c(null),d(null);const j=document.getElementById("file-upload");j&&(j.value="")},C=o.useCallback(h=>{if(h.preventDefault(),p(!1),h.dataTransfer.items&&h.dataTransfer.items[0].kind==="file"){const j=h.dataTransfer.items[0].getAsFile();j&&w(j)}},[w]),L=h=>{h.preventDefault(),p(!0)},A=()=>{p(!1)};return e.jsxs("form",{onSubmit:k,className:"space-y-4 max-w-lg mx-auto",children:[m&&e.jsx(S,{type:"error",children:m}),e.jsx("div",{onDrop:C,onDragOver:L,onDragLeave:A,className:`mt-2 flex justify-center rounded-lg border border-dashed px-6 py-10 transition-colors ${u?"border-primary-600 bg-primary-50":"border-slate-900/25"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-slate-300",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z",clipRule:"evenodd"})}),e.jsxs("div",{className:"mt-4 flex text-sm leading-6 text-slate-600",children:[e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md bg-white font-semibold text-primary-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-primary-600 focus-within:ring-offset-2 hover:text-primary-500",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:y,accept:"image/*"})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs leading-5 text-slate-600",children:"PNG, JPG, GIF up to 10MB"})]})}),l&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Image Preview:"}),e.jsx("img",{src:l,alt:"Preview",className:"max-h-40 mx-auto rounded-md border p-1"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium leading-6 text-slate-900",children:["Title ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",id:"title",value:i,onChange:h=>a(h.target.value),required:!0,className:"mt-1 block w-full rounded-md border-slate-400 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium leading-6 text-slate-900",children:"Description"}),e.jsx("textarea",{id:"description",value:n,onChange:h=>r(h.target.value),rows:3,className:"mt-1 block w-full rounded-md border-slate-400 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm p-2"})]}),t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium leading-6 text-slate-900",children:"Target Gallery"}),e.jsxs("fieldset",{className:"mt-2",children:[e.jsx("legend",{className:"sr-only",children:"Choose a gallery to upload to"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"community",name:"gallery-type",type:"radio",value:"community",checked:x==="community",onChange:h=>g(h.target.value),className:"h-4 w-4 border-gray-300 text-primary-600 focus:ring-primary-600"}),e.jsx("label",{htmlFor:"community",className:"ml-2 block text-sm font-medium text-gray-700",children:"Community Gallery"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"official",name:"gallery-type",type:"radio",value:"official",checked:x==="official",onChange:h=>g(h.target.value),className:"h-4 w-4 border-gray-300 text-primary-600 focus:ring-primary-600"}),e.jsx("label",{htmlFor:"official",className:"ml-2 block text-sm font-medium text-gray-700",children:"Official Atlas"})]})]})]})]}),e.jsx("div",{className:"text-right pt-2",children:e.jsx("button",{type:"submit",className:"inline-flex justify-center rounded-lg bg-primary-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-700 disabled:bg-slate-300 disabled:text-slate-600 disabled:cursor-not-allowed",disabled:!l||!i,children:"Submit Image"})})]})},oe=({images:s,onImageClick:t,onDelete:i,currentUser:a,isModerationView:n=!1})=>s.length===0?e.jsx("p",{className:"text-center text-slate-500 py-8",children:"No images have been submitted to this gallery yet."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:s.map(r=>e.jsxs("div",{className:"group relative",children:[e.jsxs("button",{onClick:()=>t(r),className:"aspect-square w-full bg-slate-100 rounded-lg overflow-hidden focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:[e.jsx("img",{src:r.src,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"absolute bottom-0 left-0 p-2.5 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx("h3",{className:"font-semibold text-sm leading-tight",children:r.title}),e.jsxs("p",{className:"text-xs text-slate-300",children:["by ",r.uploader]})]})]}),(a==null?void 0:a.isAdmin)&&i&&n&&e.jsx("button",{onClick:()=>i(r.id),className:"absolute -top-2 -right-2 bg-white text-red-600 rounded-full p-0.5 shadow-md hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1 opacity-100 transition-opacity","aria-label":`Delete image titled ${r.title}`,children:e.jsx(G,{className:"h-6 w-6"})})]},r.id))}),As=({image:s,onClose:t})=>(o.useEffect(()=>{const i=a=>{a.key==="Escape"&&t()};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}},[t]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 animate-fade-in",onClick:t,role:"dialog","aria-modal":"true","aria-labelledby":"image-modal-title",children:e.jsxs("div",{className:"relative p-4 bg-white rounded-lg shadow-xl max-w-4xl max-h-[90vh] w-auto flex flex-col",onClick:i=>i.stopPropagation(),children:[e.jsx("img",{src:s.src,alt:s.title,className:"object-contain max-w-full max-h-[calc(85vh-80px)] rounded"}),e.jsxs("div",{className:"pt-4 px-2 flex-shrink-0",children:[e.jsx("h2",{id:"image-modal-title",className:"text-lg font-bold text-slate-800",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:s.description}),e.jsxs("p",{className:"text-xs text-slate-400 mt-2",children:["Uploaded by: ",s.uploader]})]}),e.jsx("button",{onClick:t,className:"absolute -top-3 -right-3 bg-white rounded-full p-1 shadow-lg text-slate-600 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors","aria-label":"Close image viewer",children:e.jsx(G,{className:"h-8 w-8"})})]})})),Is=({user:s})=>{const[t,i]=o.useState("browse"),[a,n]=o.useState([]),[r,l]=o.useState([]),[c,m]=o.useState(null),[d,u]=o.useState(null),[p,x]=o.useState(""),[g,w]=o.useState(!1);o.useRef(null),o.useEffect(()=>{n(X()),l(ee())},[]);const y=(h,j)=>{const v={...h,id:`img_${Date.now()}`,uploader:j==="official"?"admin":s.username,timestamp:Date.now()};if(j==="official"&&s.isAdmin){const N=[...a,v];n(N),ye(N)}else{const N=[...r,v];l(N),ne(N)}u({type:"success",text:`Image "${v.title}" uploaded successfully to ${j==="official"?"Official Atlas":"Community Gallery"}.`}),i("browse")},k=h=>{const j=r.filter(v=>v.id!==h);l(j),ne(j)},C=()=>{u(null);try{const h={official:X(),community:ee()},j=JSON.stringify(h,null,2),v=new Blob([j],{type:"application/json"}),N=URL.createObjectURL(v),I=document.createElement("a");I.href=N,I.download="gallery.json",document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(N),u({type:"success",text:"Gallery data exported successfully as gallery.json."})}catch(h){console.error("Export failed",h),u({type:"error",text:"Failed to export gallery data."})}},L=async()=>{if(!p||!p.startsWith("https")){u({type:"error",text:"Please enter a valid HTTPS URL."});return}u(null),w(!0);try{const h=await fetch(p);if(!h.ok)throw new Error(`Failed to fetch: ${h.status} ${h.statusText}`);const j=await h.json();if(Array.isArray(j.official)&&Array.isArray(j.community))ye(j.official),ne(j.community),n(j.official),l(j.community),u({type:"success",text:"Gallery successfully synced from URL."}),x("");else throw new Error('Invalid file format. The JSON must contain "official" and "community" arrays.')}catch(h){console.error("Import from URL failed",h),u({type:"error",text:`Import failed: ${h.message}`})}finally{w(!1)}},A=({targetView:h,currentView:j,onClick:v,icon:N,children:I})=>{const ie=h===j;return e.jsxs("button",{onClick:()=>v(h),className:`flex items-center justify-center w-full sm:w-auto px-4 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 text-left ${ie?"bg-primary-200 text-primary-900 font-bold shadow-md":"text-slate-600 hover:bg-slate-200 hover:text-slate-900"}`,children:[e.jsx("div",{className:"mr-2",children:N}),I]})};return e.jsxs("div",{className:"animate-fade-in space-y-8",children:[e.jsx(T,{title:"Image Galleries",subtitle:"Browse curated images or contribute to the community collection.",icon:e.jsx(he,{className:"h-10 w-10"})}),e.jsxs(b,{children:[e.jsx("h3",{className:"text-xl font-semibold font-serif text-slate-800 mb-4 text-center",children:"Sync with GitHub Repository"}),e.jsxs("div",{className:"text-slate-600 text-sm mb-6 max-w-3xl mx-auto space-y-4 prose prose-sm prose-slate",children:[e.jsx("p",{children:"To use GitHub as a dedicated storage area for your galleries, follow this secure workflow. This method allows you to version-control your gallery data without exposing any sensitive credentials in the application."}),e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Export Gallery Data:"}),' Click the "Export Gallery" button to download a single ',e.jsx("code",{children:"gallery.json"})," file. This file contains all image data and metadata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Commit to GitHub:"})," Add the downloaded ",e.jsx("code",{children:"gallery.json"})," file to your GitHub repository. Commit and push the changes. This creates a persistent, version-controlled backup."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Load from GitHub:"})," Navigate to the ",e.jsx("code",{children:"gallery.json"}),' file in your GitHub repository, click the "Raw" button to get the direct file URL, and paste it into the "Load from URL" field below to sync the application.']})]})]}),d&&e.jsx("div",{className:"mb-4",children:e.jsx(S,{type:d.type,children:d.text})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:e.jsxs("button",{onClick:C,className:"w-full sm:w-auto flex items-center justify-center bg-sky-600 text-white font-semibold py-2.5 px-6 rounded-lg hover:bg-sky-700 transition-colors shadow-sm",children:[e.jsx(Xe,{className:"h-5 w-5 mr-2"}),"Export Gallery"]})}),e.jsxs("div",{className:"pt-4 border-t border-slate-200 max-w-xl mx-auto",children:[e.jsx("label",{htmlFor:"github-url",className:"block text-sm font-medium text-center text-slate-700 mb-2",children:"Load from URL (e.g., raw GitHub link)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"github-url",type:"url",value:p,onChange:h=>x(h.target.value),className:"w-full border border-slate-400 rounded-md shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm p-2",placeholder:"https://raw.githubusercontent.com/.../gallery.json"}),e.jsxs("button",{onClick:L,disabled:g,className:"flex-shrink-0 flex items-center justify-center bg-slate-600 text-white font-semibold px-4 rounded-lg hover:bg-slate-700 transition-colors shadow-sm disabled:bg-slate-300",children:[e.jsx(ss,{className:"h-5 w-5 mr-2"}),g?"Loading...":"Load"]})]})]})]})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-2 border-b border-slate-200 pb-4",children:[e.jsx(A,{targetView:"browse",currentView:t,onClick:i,icon:e.jsx(de,{className:"h-5 w-5"}),children:"Browse Galleries"}),e.jsx(A,{targetView:"upload",currentView:t,onClick:i,icon:e.jsx(Ze,{className:"h-5 w-5"}),children:"Upload an Image"}),s.isAdmin&&e.jsx(A,{targetView:"moderate",currentView:t,onClick:i,icon:e.jsx(es,{className:"h-5 w-5"}),children:"Moderate Submissions"})]}),t==="browse"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs(b,{className:"!shadow-none border-dashed border-2 bg-slate-50/50",children:[e.jsx("h3",{className:"text-xl font-semibold font-serif text-slate-800 mb-4",children:"Official Atlas"}),e.jsx(oe,{images:a,onImageClick:m})]}),e.jsxs(b,{className:"!shadow-none border-dashed border-2 bg-slate-50/50",children:[e.jsx("h3",{className:"text-xl font-semibold font-serif text-slate-800 mb-4",children:"Community Submissions"}),e.jsx(oe,{images:r,onImageClick:m,currentUser:s})]})]}),t==="upload"&&e.jsxs(b,{className:"!shadow-none border-dashed border-2 bg-slate-50/50",children:[e.jsx("h3",{className:"font-semibold text-slate-800 mb-4 text-center",children:"Contribute an Image"}),e.jsx(Ss,{onUpload:y,showGallerySelector:s.isAdmin})]}),t==="moderate"&&s.isAdmin&&e.jsxs(b,{className:"!shadow-none border-dashed border-2 bg-slate-50/50",children:[e.jsx("h3",{className:"text-xl font-semibold font-serif text-slate-800 mb-4",children:"Moderate Community Submissions"}),e.jsx(oe,{images:r,onImageClick:m,onDelete:k,currentUser:s,isModerationView:!0})]})]}),c&&e.jsx(As,{image:c,onClose:()=>m(null)})]})},R=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center mr-4",children:e.jsx("div",{className:"text-primary-600",children:s})}),e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800",children:t})]}),be=[{question:"Based on the learner profile, what is the primary motivation for a pathology resident using this module?",options:[{id:"a",text:"General interest in lung diseases."},{id:"b",text:"A requirement for their academic curriculum."},{id:"c",text:"Achieving diagnostic competence for daily work and board exams."},{id:"d",text:"Learning basic histology from scratch."}],correctAnswer:"c",feedback:{a:"While interest is a factor, their primary driver is more practical and goal-oriented.",b:"This might be true, but their personal motivation is tied to professional competence.",c:"Correct. Residents are goal-oriented and focused on practical skills for their job and high-stakes exams.",d:"Incorrect. The analysis shows they already have a strong foundation in basic histology."}},{question:"What is the core diagnostic challenge this module aims to address?",options:[{id:"a",text:"The inability to identify a granuloma on a slide."},{id:"b",text:"The significant morphologic overlap between different causes of granulomas."},{id:"c",text:"A lack of knowledge about special stains."},{id:"d",text:"Difficulty in using a microscope."}],correctAnswer:"b",feedback:{a:"Incorrect. The analysis specifies that residents can already identify a granuloma; the problem is differentiating them.",b:"Correct. The key difficulty is that many different diseases can produce very similar-looking granulomas, requiring integrated reasoning.",c:"While important, knowing which stain to order is secondary to first understanding the differential diagnosis based on morphology.",d:"This is a basic skill assumed to be competent in pathology residents."}}],Ls=({user:s})=>{const[t,i]=o.useState([null,null]),a=(n,r)=>{if(t[n]===null){const l=[...t];l[n]=r,i(l);const c=be[n],m=c.options.find(d=>d.id===r);_(s.username,f.ANALYSIS,`q${n+1}`,{question:c.question,selectedAnswer:(m==null?void 0:m.text)||"N/A",isCorrect:r===c.correctAnswer,timestamp:Date.now()})}};return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Phase 1: Analysis",subtitle:"Defining the learner, their knowledge gaps, and the context for learning."}),e.jsxs(b,{children:[e.jsx(R,{icon:e.jsx(We,{className:"h-6 w-6"}),title:"1. Identify the Learner"}),e.jsxs("ul",{className:"space-y-4 text-slate-600 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Who are they?"})," Pathology residents (PGY 1-3) with foundational medical knowledge."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Background Knowledge:"})," Strong understanding of general medicine, basic pathophysiology, and histology. They can define and identify a granuloma."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Experience Level:"})," Novice-to-Intermediate diagnosticians transitioning from theory to practice."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Motivations:"})," Goal-oriented, seeking diagnostic competence for daily work and board certification. They are practical, time-constrained, and highly visual learners."]})]})]}),e.jsxs(b,{children:[e.jsx(R,{icon:e.jsx(le,{className:"h-6 w-6"}),title:"2. Analyze the Topic"}),e.jsxs("p",{className:"text-slate-600 mb-4",children:["The core difficulty is not identifying a granuloma, but differentiating between causes due to ",e.jsx("strong",{children:"significant morphologic overlap"}),"."]}),e.jsxs("ul",{className:"space-y-4 text-slate-600 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Vast Differential Diagnosis:"})," Spans infectious, autoimmune, environmental, and drug-induced categories."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Non-Specific Histology:"})," Histologic patterns alone are often insufficient for a definitive diagnosis."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Necessity of Clinical Correlation:"})," Diagnosis requires skillful integration of clinical history, radiology, and microbiology with histology."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Use of Ancillary Studies:"})," A critical skill is knowing which special stains to order and how to interpret them."]})]})]}),e.jsxs(b,{children:[e.jsx(R,{icon:e.jsx(Ve,{className:"h-6 w-6"}),title:"3. Define the Knowledge Gap"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-700 mb-2",children:"Current State (What they can do)"}),e.jsxs("ul",{className:"space-y-2 text-slate-600 list-disc list-inside",children:[e.jsx("li",{children:"Define a granuloma."}),e.jsx("li",{children:"Identify a granuloma on a slide."}),e.jsx("li",{children:'Broadly classify as "necrotizing" or "non-necrotizing."'}),e.jsx("li",{children:"List a few classic causes."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-700 mb-2",children:"Desired State (What they need to do)"}),e.jsxs("ul",{className:"space-y-2 text-slate-600 list-disc list-inside",children:[e.jsx("li",{children:"Systematically evaluate morphology (quality, distribution)."}),e.jsx("li",{children:"Formulate a pattern-based differential diagnosis."}),e.jsx("li",{children:"Integrate multi-modal data (clinical, radiologic)."}),e.jsx("li",{children:"Guide the clinical workup with appropriate recommendations."})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsxs(S,{type:"info",title:"The Core Challenge",children:["The fundamental gap is the transition from ",e.jsx("span",{className:"font-bold",children:"simple identification"})," to ",e.jsx("span",{className:"font-bold",children:"integrated diagnostic reasoning"}),"."]})})]}),e.jsxs(b,{children:[e.jsx(R,{icon:e.jsx(z,{className:"h-6 w-6"}),title:"Output of this Phase: The Recipe"}),e.jsxs("ul",{className:"space-y-3 text-slate-600 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{className:"text-slate-700",children:"Instructional Goal:"})," Advance from simple identification to clinically-integrated differential diagnosis."]}),e.jsxs("li",{children:[e.jsx("strong",{className:"text-slate-700",children:"Core Problem to Solve:"})," The vast and histologically overlapping differential diagnosis."]}),e.jsxs("li",{children:[e.jsx("strong",{className:"text-slate-700",children:"Instructional Approach:"})," Must be case-based and highly visual, structured by histologic pattern to mimic the actual diagnostic process."]})]})]}),e.jsxs(b,{children:[e.jsx(R,{icon:e.jsx(z,{className:"h-6 w-6"}),title:"Knowledge Check"}),e.jsx("div",{className:"space-y-8",children:be.map((n,r)=>e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-slate-700 mb-4",children:[r+1,". ",n.question]}),e.jsx("div",{className:"space-y-3",children:n.options.map(l=>{const c=t[r]!==null,m=t[r]===l.id,d=l.id===n.correctAnswer;let u="bg-white border-slate-300 hover:bg-slate-50 hover:border-slate-400 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500";return c&&(d?u="bg-green-50 border-green-500 text-green-900":m?u="bg-red-50 border-red-500 text-red-900":u="bg-slate-50 border-slate-300 text-slate-500 cursor-default"),e.jsxs("button",{onClick:()=>a(r,l.id),disabled:c,className:`w-full text-left p-4 border rounded-lg transition-all duration-200 flex items-center justify-between ${u} ${c?"cursor-default":"cursor-pointer"}`,children:[e.jsx("span",{children:l.text}),c&&d&&m&&e.jsx(W,{className:"h-5 w-5 text-green-600"}),c&&m&&!d&&e.jsx(G,{className:"h-5 w-5 text-red-600"})]},l.id)})}),t[r]&&e.jsx("div",{className:"mt-4",children:e.jsx(S,{type:t[r]===n.correctAnswer?"success":"error",children:n.feedback[t[r]]})})]},r))})]})]})},Ts=()=>e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Phase 2: Design",subtitle:"Creating specific, measurable learning objectives based on the analysis."}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-4",children:"Selecting Bloom's Taxonomy Levels"}),e.jsx("p",{className:"text-slate-600 leading-relaxed mb-4",children:"The analysis revealed that the core problem is not a lack of foundational knowledge, but the inability to apply and synthesize it. Therefore, this module targets higher-order thinking skills."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"bg-slate-100 text-slate-700 text-sm font-medium px-3 py-1 rounded-full",children:"Remember"}),e.jsx("span",{className:"bg-slate-100 text-slate-700 text-sm font-medium px-3 py-1 rounded-full",children:"Understand"}),e.jsx("span",{className:"bg-primary-100 text-primary-800 text-sm font-bold px-3 py-1 rounded-full",children:"Apply"}),e.jsx("span",{className:"bg-primary-100 text-primary-800 text-sm font-bold px-3 py-1 rounded-full",children:"Analyze"}),e.jsx("span",{className:"bg-primary-100 text-primary-800 text-sm font-bold px-3 py-1 rounded-full",children:"Evaluate"}),e.jsx("span",{className:"bg-primary-100 text-primary-800 text-sm font-bold px-3 py-1 rounded-full",children:"Create"})]}),e.jsxs("p",{className:"mt-4 text-slate-600 leading-relaxed",children:["Instruction will operate primarily at the ",e.jsx("strong",{children:"Apply, Analyze, and Evaluate"})," levels, culminating in a ",e.jsx("strong",{children:"Create"})," task (formulating a diagnostic report)."]})]}),e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-2 text-center",children:"Learning Objectives"}),e.jsx("p",{className:"text-slate-600 leading-relaxed mb-8 text-center",children:"Upon completion of this module, the learner will be able to:"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{className:"!mb-0 border-l-4 border-primary-500 bg-slate-50",children:[e.jsx("h3",{className:"font-bold text-lg font-serif text-slate-800 mb-2",children:"Objective 1: Analyze"}),e.jsxs("p",{className:"text-slate-600",children:["Given a high-resolution digital image of a lung biopsy containing granulomas, the pathology resident will ",e.jsx("strong",{className:"text-slate-800",children:"differentiate"})," the key morphologic features by correctly identifying the type of granuloma, its architectural distribution, and any associated findings."]})]}),e.jsxs(b,{className:"!mb-0 border-l-4 border-green-500 bg-slate-50",children:[e.jsx("h3",{className:"font-bold text-lg font-serif text-slate-800 mb-2",children:"Objective 2: Evaluate & Create"}),e.jsxs("p",{className:"text-slate-600",children:["Given a case study that includes a histologic pattern, a brief clinical history, and radiologic findings, the resident will ",e.jsx("strong",{className:"text-slate-800",children:"synthesize"})," the information to construct a clinically relevant, ranked differential diagnosis, justifying the top two diagnoses with specific evidence."]})]}),e.jsxs(b,{className:"!mb-0 border-l-4 border-purple-500 bg-slate-50",children:[e.jsx("h3",{className:"font-bold text-lg font-serif text-slate-800 mb-2",children:"Objective 3: Apply & Evaluate"}),e.jsxs("p",{className:"text-slate-600",children:["Based on a formulated differential diagnosis for a case, the resident will ",e.jsx("strong",{className:"text-slate-800",children:"propose"})," the most appropriate ancillary studies and correctly interpret the diagnostic implications of both a positive and a negative result, including limitations."]})]})]})]})]}),Ps=({text:s="Loading..."})=>e.jsxs("div",{className:"flex items-center justify-center h-full my-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-primary-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-3 text-slate-600",children:s})]}),Ms=()=>{const[s,t]=o.useState(!1),[i,a]=o.useState(null),[n,r]=o.useState(!0),l={clinical:"You receive a lung wedge biopsy from a 55-year-old man with a 6-month history of progressive shortness of breath and a dry cough. He is a non-smoker but has kept pigeons in his attic for over 20 years. A chest CT shows diffuse, bilateral ground-glass opacities with centrilobular nodules.",histology:"The biopsy shows a cellular interstitial pneumonia. There are numerous small, poorly-formed granulomas centered on the bronchioles (bronchiolocentric). The granulomas are composed of loose collections of epithelioid histiocytes and multinucleated giant cells. There is no necrosis. The surrounding interstitium is expanded by a dense lymphoplasmacytic infiltrate, and scattered eosinophils are present. You also note foci of organizing pneumonia."};return o.useEffect(()=>{(async()=>{r(!0);const m=`The case is about Hypersensitivity Pneumonitis. ${l.clinical} ${l.histology}`,d=await O(m);a(d),r(!1)})()},[]),e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Phase 3: Development",subtitle:"Creating the instructional content, media, and activities."}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-4",children:"Comparative Job Aid: Sarcoidosis vs. Tuberculosis"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"This table highlights key distinguishing features between two common entities. Use it as a quick reference at the microscope."}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-slate-500",children:[e.jsx("thead",{className:"text-xs text-slate-700 uppercase bg-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-4 font-semibold rounded-l-lg",children:"Feature"}),e.jsx("th",{scope:"col",className:"px-6 py-4 font-semibold",children:"Classic Finding in Sarcoidosis"}),e.jsx("th",{scope:"col",className:"px-6 py-4 font-semibold rounded-r-lg",children:"Classic Finding in Tuberculosis"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200",children:[e.jsxs("tr",{className:"bg-white",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-slate-900 whitespace-nowrap",children:"Granuloma Type"}),e.jsx("td",{className:"px-6 py-4",children:'Tightly formed, well-circumscribed, "naked" (scant lymphocytes).'}),e.jsx("td",{className:"px-6 py-4",children:"Can be well-formed or poorly-formed, often confluent, prominent rim of lymphocytes."})]}),e.jsxs("tr",{className:"bg-white",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-slate-900 whitespace-nowrap",children:"Necrosis"}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("strong",{children:"Non-necrotizing"}),' ("non-caseating").']}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("strong",{children:"Caseating necrosis"})," (eosinophilic, granular, acellular debris)."]})]}),e.jsxs("tr",{className:"bg-white",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-slate-900 whitespace-nowrap",children:"Distribution"}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("strong",{children:"Lymphangitic"})," (along bronchovascular bundles, septa, pleura)."]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("strong",{children:"Apical and cavitary"})," (typically upper lobes)."]})]}),e.jsxs("tr",{className:"bg-white",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-slate-900 whitespace-nowrap",children:"Associated Findings"}),e.jsx("td",{className:"px-6 py-4",children:"Schaumann bodies, Asteroid bodies."}),e.jsx("td",{className:"px-6 py-4",children:"Acid-fast bacilli (AFB) visible with special stain."})]})]})]})})]}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-4",children:`Interactive Case Study: "The Bird Fancier's Cough"`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg font-serif text-slate-800 mb-2",children:"Part 1: Clinical & Radiologic Data"}),e.jsx("p",{className:"text-slate-600",children:l.clinical})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg font-serif text-slate-800 mb-2",children:"Part 2: Histologic Findings"}),e.jsxs("div",{className:"space-y-3",children:[n?e.jsx("div",{className:"w-full h-64 sm:h-96 bg-slate-100 rounded-lg shadow-md flex items-center justify-center",children:e.jsx(Ps,{text:"Finding relevant image..."})}):e.jsx(M,{staticImageUrl:i==null?void 0:i.src,altText:(i==null?void 0:i.title)||"AI-selected image for the case study."}),i&&e.jsxs("p",{className:"text-center text-sm text-slate-600 font-semibold italic",children:['AI-selected image from gallery: "',i.title,'"']}),e.jsx("p",{className:"text-slate-600 flex-1 pt-2",children:l.histology})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg font-serif text-slate-800 mb-2",children:"Part 3: The Diagnostic Task"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Given the integrated clinical, radiologic, and histologic findings, construct a ranked differential diagnosis. Justify your top two choices."}),e.jsx("button",{onClick:()=>t(!s),className:"bg-primary-600 text-white font-medium py-2 px-5 rounded-lg hover:bg-primary-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 transition-colors shadow-sm",children:s?"Hide Expert Answer":"Reveal Expert Answer"}),s&&e.jsxs("div",{className:"mt-6 space-y-4 animate-fade-in",children:[e.jsxs(S,{type:"success",title:"1. Hypersensitivity Pneumonitis (Subacute/Chronic)",children:[e.jsx("strong",{children:"Justification:"})," This is the leading diagnosis. The clinical history (pigeon keeping), radiology (ground-glass, centrilobular nodules), and histology (cellular interstitial pneumonia, bronchiolocentric distribution, poorly-formed non-necrotizing granulomas) align perfectly."]}),e.jsxs(S,{type:"info",title:"2. Sarcoidosis",children:[e.jsx("strong",{children:"Justification:"})," This is on the differential but less likely. In sarcoidosis, granulomas are typically well-formed and tight with a lymphangitic distribution, which is discordant with this case."]})]})]})]})]})]})},we=[{id:"A",text:"Sarcoidosis"},{id:"B",text:"Hypersensitivity Pneumonitis"},{id:"C",text:"Tuberculosis"},{id:"D",text:"Berylliosis"}],D="A",F={A:{title:"Sarcoidosis",rationale:"This is the classic presentation. The combination of bilateral hilar lymphadenopathy in an asymptomatic young adult with well-formed, non-necrotizing granulomas in a lymphangitic distribution is pathognomonic.",isCorrect:!0},B:{title:"Hypersensitivity Pneumonitis",rationale:"Incorrect. The granulomas in HP are typically poorly-formed and bronchiolocentric, not well-formed and lymphangitic. The clinical picture is also not typical for HP.",isCorrect:!1},C:{title:"Tuberculosis",rationale:'Incorrect. The stem explicitly states the granulomas are "non-necrotizing." Classic post-primary tuberculosis is characterized by caseating necrotizing granulomas.',isCorrect:!1},D:{title:"Berylliosis",rationale:"Incorrect. While histologically indistinguishable from sarcoidosis, berylliosis requires a specific clinical history of exposure to beryllium, which is absent here. Sarcoidosis is far more common.",isCorrect:!1}},K={clinical:"A 35-year-old woman presents for a pre-employment physical. She is asymptomatic. A routine chest X-ray reveals an abnormality, prompting a CT scan and subsequent transbronchial biopsy. The chest CT demonstrates bilateral hilar lymphadenopathy and subtle perilymphatic nodularity.",histology:"Examination shows numerous, discrete, and well-formed non-necrotizing granulomas. They are composed of tight clusters of epithelioid histiocytes with scattered multinucleated giant cells and a minimal lymphocytic cuff. They are observed in the submucosa of a bronchiole and expanding the interstitium of adjacent alveolar septa, consistent with a lymphangitic distribution."},Es=({text:s="Loading..."})=>e.jsxs("div",{className:"flex items-center justify-center h-full my-4",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-primary-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-3 text-slate-600",children:s})]}),Ds=({user:s})=>{const[t,i]=o.useState(null),[a,n]=o.useState(!1),[r,l]=o.useState(null),[c,m]=o.useState(!0);o.useEffect(()=>{(async()=>{m(!0);const g=`The case is about Sarcoidosis. ${K.clinical} ${K.histology}`,w=await O(g);l(w),m(!1)})()},[]);const d=x=>{a||i(x)},u=()=>{if(t){n(!0);const x=we.find(g=>g.id===t);_(s.username,f.EVALUATION,"finalQuestion",{question:"Based on the integration of all findings, what is the most likely diagnosis?",selectedAnswer:(x==null?void 0:x.text)||"N/A",isCorrect:t===D,timestamp:Date.now()})}},p=x=>a?x===D?"bg-green-50 border-green-500 text-green-900":x===t?"bg-red-50 border-red-500 text-red-900":"bg-slate-100 border-slate-300 text-slate-500 cursor-default":t===x?"bg-primary-100 border-primary-400 ring-2 ring-primary-300":"bg-white border-slate-300 hover:bg-slate-50 hover:border-slate-400";return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Board-Style Question",subtitle:"Measuring your ability to integrate findings and form a diagnosis."}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-2xl font-semibold font-serif text-slate-800 mb-2",children:"Question: Integrate and Diagnose"}),e.jsxs("div",{className:"bg-slate-50 p-6 rounded-lg border border-slate-200 text-slate-600 space-y-4 mb-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Stem:"})," ",K.clinical]}),e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Microscopic Findings:"})}),c&&e.jsx(Es,{text:"Finding relevant image..."}),r&&e.jsxs("div",{className:"my-4 space-y-2 animate-fade-in",children:[e.jsx(M,{staticImageUrl:r.src,altText:r.title}),e.jsxs("p",{className:"text-center text-sm text-slate-600 font-semibold italic",children:['AI-selected image from gallery: "',r.title,'"']})]}),e.jsx("p",{children:K.histology})]})]}),e.jsx("p",{className:"font-semibold text-slate-700 mb-4",children:"Based on the integration of all findings, what is the most likely diagnosis?"}),e.jsx("div",{className:"space-y-3",children:we.map(x=>e.jsxs("button",{onClick:()=>d(x.id),disabled:a,className:`w-full text-left p-4 border rounded-lg transition-all duration-200 flex items-center ${p(x.id)} ${a?"cursor-default":"cursor-pointer"}`,children:[e.jsxs("span",{className:"font-bold mr-4 text-slate-500",children:[x.id,"."]}),e.jsx("span",{className:"flex-1",children:x.text}),a&&x.id===D&&e.jsx(W,{className:"h-6 w-6 text-green-600"}),a&&x.id===t&&x.id!==D&&e.jsx(G,{className:"h-6 w-6 text-red-600"})]},x.id))}),e.jsx("div",{className:"mt-8 border-t border-slate-200 pt-6 text-center",children:e.jsx("button",{onClick:u,disabled:!t||a,className:"bg-primary-600 text-white font-semibold py-2.5 px-8 rounded-lg hover:bg-primary-700 transition-colors disabled:bg-slate-300 disabled:text-slate-600 disabled:cursor-not-allowed focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 shadow-sm",children:"Submit Answer"})}),a&&e.jsxs("div",{className:"mt-8 space-y-4 animate-fade-in",children:[t&&e.jsx(S,{type:F[t].isCorrect?"success":"error",title:F[t].isCorrect?`Correct: ${F[t].title}`:`Incorrect: ${F[t].title}`,children:F[t].rationale}),t!==D&&e.jsx(S,{type:"info",title:`The Correct Answer was: ${F[D].title}`,children:F[D].rationale})]})]})]})},Fs={version:"1.0.0",schema:"who-2022-thoracic",entities:{tuberculosis:{category:"infectious",patterns:[{keyword:"caseous",description:"caseating necrosis"},{keyword:"langhans",description:"Langhans giant cells"}],cells:["epithelioid histiocytes","Langhans giant cells","lymphocytes"],difficulty:"advanced",tags:["mycobacterial","caseating","necrosis"],teachingPoint:"Caseating granulomas with central necrosis suggest mycobacterial infection (e.g., TB).",caseContext:"Tuberculosis typically shows caseating granulomas with Langhans giant cells. AFB staining may reveal acid-fast bacilli."},histoplasmosis:{category:"infectious",patterns:[{keyword:"yeast",description:"intracellular yeast forms"}],cells:["epithelioid histiocytes","intracellular yeast","macrophages"],difficulty:"advanced",tags:["fungal","dimorphic","yeast"],teachingPoint:"Small intracellular yeast forms with narrow-based budding are characteristic of histoplasmosis.",caseContext:"Histoplasmosis granulomas contain small yeast forms within macrophages. GMS or PAS staining highlights the organisms."},sarcoidosis:{category:"noninfectious",patterns:[{keyword:"noncaseating",description:"noncaseating granulomas"}],cells:["epithelioid histiocytes","asteroid bodies (sometimes)","lymphocytes"],difficulty:"intermediate",tags:["noncaseating","systemic","asteroid"],teachingPoint:"Noncaseating granulomas in the appropriate clinical setting support sarcoidosis.",caseContext:"Sarcoidosis features well-formed noncaseating granulomas. Asteroid bodies may be seen but are not specific."},rheumatoid:{category:"autoimmune",patterns:[{keyword:"necrobiotic",description:"necrobiotic granulomas"}],cells:["histiocytes","fibroblasts","lymphocytes"],difficulty:"intermediate",tags:["autoimmune","necrobiotic","rheumatoid"],teachingPoint:"Rheumatoid nodules show central necrobiotic material surrounded by palisading histiocytes.",caseContext:"Rheumatoid lung nodules demonstrate necrobiotic granulomas with a fibrinoid center and palisading histiocytes."}},stainRoles:{"H&E":"general morphology",GMS:"highlight fungal cell walls",PAS:"highlight fungal cell walls and mucin",AFB:"highlight mycobacterial organisms",Polarized:"reveal polarizable foreign material"},difficultyLevels:{beginner:"Classic presentations with obvious diagnostic features",intermediate:"Moderate diagnostic complexity, requires pattern recognition",advanced:"Subtle findings, mimics, or rare presentations"},caseTypes:{classic:"Classic textbook presentation of the disease",atypical:"Unusual or variant presentation",mimic:"Presentation that mimics other conditions",complicated:"Case with additional complications or comorbidities"}},se=Fs;async function Gs(s,t){if(s.entity&&s.difficulty)return s;const i=`
        You are an expert pathologist's assistant. Your task is to analyze the metadata of a histology image and classify it.
        The image title is: "${s.title}"
        The image description is: "${s.description}"
        
        Here is a list of known entities: ${Object.keys(se.entities).join(", ")}.
        Here are the possible difficulty levels: ${Object.keys(se.difficultyLevels).join(", ")}.

        Based on the title and description, determine the single most likely entity and the most appropriate difficulty level.
        Respond with a single JSON object with no markdown formatting. The format should be: {"entity": "the_best_entity", "difficulty": "the_best_difficulty"}.
        If you cannot determine the entity, respond with {"entity": null, "difficulty": "intermediate"}.
    `;try{const a=await t.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json",responseSchema:{type:P.OBJECT,properties:{entity:{type:P.STRING,nullable:!0},difficulty:{type:P.STRING}},required:["entity","difficulty"]}}}),n=JSON.parse(a.text.trim());return{...s,entity:n.entity||"unknown",difficulty:n.difficulty||"intermediate"}}catch(a){return console.warn(`AI metadata enrichment failed for image ${s.id}:`,a),{...s,entity:"unknown",difficulty:"intermediate"}}}async function Hs(){console.log("Starting case mapping generation...");const s=new Z({apiKey:void 0});let t=us(),i=Pe();const a=[...X(),...ee()],n=await Promise.all(a.map(d=>Gs(d,s))),r={};for(const d of n){if(!d.entity||d.entity==="unknown")continue;const u=`${d.entity}_${d.difficulty}`;r[u]||(r[u]=[]),r[u].push(d)}let l=0,c=0,m=Object.keys(t.cases).length+1;for(const[d,u]of Object.entries(r)){const[p,x]=d.split("_"),g=Object.values(t.cases).find(w=>w.entity===p&&w.difficulty===x);if(g)g.updatedAt=new Date().toISOString(),t.cases[g.caseId]=g,c++;else{const w=`CASE${m.toString().padStart(3,"0")}`,y=se.entities[p]||{},k={caseId:w,title:`${p.charAt(0).toUpperCase()+p.slice(1)} Case (${x})`,entity:p,category:y.category||"unknown",difficulty:x,caseType:"classic",description:y.teachingPoint||`Case demonstrating ${p} at a ${x} level.`,caseContext:y.caseContext||`Histologic features of ${p}.`,learningObjectives:[`Recognize histologic features of ${p}`,`Differentiate ${p} from other granulomatous diseases`],tags:y.tags||[p],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};t.cases[w]=k,l++,m++}}for(const d of Object.values(t.cases)){const u=n.filter(g=>g.entity===d.entity&&g.difficulty===d.difficulty),p=se.entities[d.entity]||{},x={...d,images:u.map((g,w)=>({imageId:`${d.caseId}_IMG${(w+1).toString().padStart(3,"0")}`,path:g.src,stain:"H&E",caption:g.title,findings:p.cells||[]})),discussion:`This case demonstrates ${d.entity}. ${d.caseContext}`,teachingPoints:[d.description,`Key features include: ${(p.cells||[]).join(", ")||"granulomatous inflammation"}`],references:["WHO Classification of Thoracic Tumours, 5th Edition","Pathology of Granulomatous Diseases, Current Diagnostic Criteria"]};i.caseStudies[d.caseId]=x}return gs(t),xs(i),console.log(`Case mapping complete. ${l} created, ${c} updated. Total: ${Object.keys(t.cases).length}`),{casesCreated:l,casesUpdated:c,totalCases:Object.keys(t.cases).length}}const Bs=()=>{const[s,t]=o.useState({}),[i,a]=o.useState(null),[n,r]=o.useState(!1),[l,c]=o.useState(null),[m,d]=o.useState(null);o.useEffect(()=>{t(bs())},[]);const u=g=>{a(i===g?null:g)},p=async()=>{r(!0),c(null),d(null);try{const g=await Hs();c(`Case mapping complete. ${g.casesCreated} new cases created, ${g.casesUpdated} cases updated. A total of ${g.totalCases} cases are now in the library.`)}catch(g){console.error("Case generation failed",g),d(`Failed to generate cases: ${g.message}`)}finally{r(!1)}},x=Object.keys(s);return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(T,{title:"Admin Dashboard",subtitle:"Manage module data and user activity."}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-xl font-semibold font-serif text-slate-800 mb-4",children:"Case Management"}),e.jsx("p",{className:"text-slate-600 text-sm mb-4",children:"Use the button below to automatically generate case studies. This process will:"}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-slate-600 mb-6 space-y-1",children:[e.jsx("li",{children:"Scan all images in the Official and Community galleries."}),e.jsx("li",{children:"Use Gemini AI to analyze image titles and descriptions to determine the disease entity and difficulty."}),e.jsx("li",{children:"Group related images together to form new cases or update existing ones."}),e.jsx("li",{children:'Generate detailed case study data for the new "Case Library" section.'})]}),l&&e.jsx(S,{type:"success",children:l}),m&&e.jsx(S,{type:"error",children:m}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("button",{onClick:p,disabled:n,className:"bg-primary-600 text-white font-semibold py-2.5 px-6 rounded-lg hover:bg-primary-700 transition-colors disabled:bg-slate-400 flex items-center justify-center mx-auto",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),n?"Generating Cases...":"Generate & Update Case Library"]})})]}),e.jsxs(b,{children:[e.jsx("h2",{className:"text-xl font-semibold font-serif text-slate-800 mb-4",children:"User Activity"}),e.jsxs("p",{className:"text-slate-600 text-sm mb-4",children:["Tracking responses from ",x.length," user(s). Click on a user to expand their activity log."]}),x.length===0?e.jsx("p",{className:"text-slate-500 text-center py-4",children:"No user data has been recorded yet."}):e.jsx("div",{className:"space-y-4",children:x.map(g=>e.jsxs("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>u(g),className:"w-full text-left p-4 bg-slate-50 hover:bg-slate-100 transition-colors flex justify-between items-center focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500","aria-expanded":i===g,"aria-controls":`user-data-${g}`,children:[e.jsx("span",{className:"font-semibold text-slate-800",children:g}),e.jsx("span",{className:`transform transition-transform duration-200 ${i===g?"rotate-180":""}`,children:e.jsx("svg",{className:"h-5 w-5 text-slate-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),i===g&&e.jsxs("div",{id:`user-data-${g}`,className:"p-4 sm:p-6 bg-white space-y-6",children:[Object.keys(s[g]).length===0&&e.jsx("p",{children:"No activity recorded for this user."}),s[g].Analysis&&e.jsx(Q,{title:"Analysis Phase Quiz",data:s[g].Analysis}),s[g].Evaluation&&e.jsx(Q,{title:"Evaluation Phase Quiz",data:{"Final Question":s[g].Evaluation}}),s[g].VisualChallenge&&e.jsx(Q,{title:"Visual Challenge",data:s[g].VisualChallenge}),s[g].DiagnosticPathway&&e.jsx(Q,{title:"Diagnostic Pathway",data:s[g].DiagnosticPathway}),s[g].AICaseGenerator&&e.jsx(_s,{title:"AI Case Generator",data:s[g].AICaseGenerator})]})]},g))})]})]})},Q=({title:s,data:t})=>e.jsxs(b,{className:"!shadow-md !mb-0 border border-slate-200 bg-slate-50/50",children:[e.jsx("h3",{className:"text-lg font-semibold font-serif text-slate-800 mb-4",children:s}),e.jsx("ul",{className:"space-y-4",children:Object.keys(t).map(i=>{const a=t[i];return e.jsxs("li",{className:"p-3 bg-white rounded-md border border-slate-200",children:[e.jsx("p",{className:"font-semibold text-sm text-slate-700",children:a.question}),e.jsxs("div",{className:"flex items-center mt-2",children:[a.isCorrect?e.jsx(W,{className:"h-5 w-5 text-green-500 mr-2 flex-shrink-0"}):e.jsx(G,{className:"h-5 w-5 text-red-500 mr-2 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Answered: ",e.jsx("span",{className:"font-medium",children:a.selectedAnswer})]})]})]},i)})})]}),_s=({title:s,data:t})=>e.jsxs(b,{className:"!shadow-md !mb-0 border border-slate-200 bg-slate-50/50",children:[e.jsx("h3",{className:"text-lg font-semibold font-serif text-slate-800 mb-4",children:s}),e.jsx("div",{className:"space-y-6",children:t.map((i,a)=>e.jsxs("div",{className:"p-4 bg-white rounded-lg border border-slate-200",children:[e.jsxs("h4",{className:"font-semibold text-md text-slate-700 mb-3 pb-2 border-b",children:["Case #",a+1," - Diagnosis: ",e.jsx("span",{className:"font-bold",children:i.caseData.diagnosis})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-slate-600",children:"Clinical:"})," ",e.jsx("p",{className:"text-slate-500 italic mt-1",children:i.caseData.clinicalHistory})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-slate-600",children:"User's Diagnosis:"})," ",e.jsx("p",{className:"text-slate-500 italic mt-1",children:i.userDx})]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-slate-600",children:"AI Feedback:"})," ",e.jsx("p",{className:"text-slate-500 italic mt-1",children:i.feedback})]})]})]},a))})]}),Os=({isOpen:s,onClose:t,user:i})=>{const[a,n]=o.useState(""),[r,l]=o.useState(""),[c,m]=o.useState(""),[d,u]=o.useState(null),[p,x]=o.useState(null),g=w=>{if(w.preventDefault(),u(null),x(null),r!==c){u("New passwords do not match.");return}if(r.length<6){u("New password must be at least 6 characters long.");return}try{_e(i.username,a,r),x("Password changed successfully!"),n(""),l(""),m(""),setTimeout(()=>{t(),x(null)},2e3)}catch(y){u(y.message)}};return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 animate-fade-in","aria-labelledby":"change-password-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"relative bg-white w-full max-w-md m-4 p-8 rounded-2xl shadow-2xl",role:"document",children:[e.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-slate-500 hover:text-slate-800","aria-label":"Close modal",children:e.jsx("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center mr-4",children:e.jsx(me,{className:"h-6 w-6 text-primary-600"})}),e.jsx("h2",{id:"change-password-title",className:"text-2xl font-bold font-serif text-slate-800",children:"Change Password"})]}),d&&e.jsx("div",{className:"mb-4",children:e.jsx(S,{type:"error",children:d})}),p&&e.jsx("div",{className:"mb-4",children:e.jsx(S,{type:"success",children:p})}),e.jsxs("form",{onSubmit:g,className:"space-y-5",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"current-password",className:"sr-only",children:"Current Password"}),e.jsx(H,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"current-password",type:"password",value:a,onChange:w=>n(w.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500",placeholder:"Current Password",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"new-password",className:"sr-only",children:"New Password"}),e.jsx(H,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"new-password",type:"password",value:r,onChange:w=>l(w.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500",placeholder:"New Password",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"confirm-password",className:"sr-only",children:"Confirm New Password"}),e.jsx(H,{className:"pointer-events-none w-5 h-5 absolute top-1/2 transform -translate-y-1/2 left-4 text-slate-400"}),e.jsx("input",{id:"confirm-password",type:"password",value:c,onChange:w=>m(w.target.value),className:"w-full py-3 pl-12 pr-4 border border-slate-400 rounded-lg focus:ring-primary-500 focus:border-primary-500",placeholder:"Confirm New Password",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full bg-primary-600 text-white font-semibold py-2.5 px-5 rounded-lg hover:bg-primary-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary-500 transition-all duration-200 shadow-sm hover:shadow-md",children:"Update Password"})]})]})}):null},Us=({user:s,onLogout:t})=>{const{currentSection:i,handleSectionChange:a}=ze(s.username),[n,r]=o.useState(!1),[l,c]=o.useState(!1),m=u=>{a(u),r(!1)},d=()=>{switch(i){case f.HOME:return e.jsx(fe,{onSectionChange:m});case f.JOB_AID:return e.jsx(ds,{});case f.CASE_STUDY:return e.jsx(hs,{});case f.CASE_LIBRARY:return e.jsx(ys,{user:s});case f.VISUAL_CHALLENGE:return e.jsx(ws,{user:s});case f.DIAGNOSTIC_PATHWAY:return e.jsx(ks,{user:s});case f.AI_CASE_GENERATOR:return e.jsx(Cs,{user:s});case f.IMAGE_GALLERIES:return e.jsx(Is,{user:s});case f.ANALYSIS:return e.jsx(Ls,{user:s});case f.DESIGN:return e.jsx(Ts,{});case f.DEVELOPMENT:return e.jsx(Ms,{});case f.EVALUATION:return e.jsx(Ds,{user:s});case f.ADMIN:return e.jsx(Bs,{});default:return e.jsx(fe,{onSectionChange:m})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:`fixed inset-0 z-30 transition-transform transform ${n?"translate-x-0":"-translate-x-full"} md:hidden`,children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>r(!1)}),e.jsx("div",{className:"relative w-72 h-full",children:e.jsx(xe,{user:s,onLogout:t,currentSection:i,onSectionChange:m,onChangePasswordClick:()=>c(!0),className:"h-full"})})]}),e.jsx(xe,{user:s,onLogout:t,currentSection:i,onSectionChange:m,onChangePasswordClick:()=>c(!0),className:"hidden md:block w-72 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx(ls,{currentSection:i,onMenuClick:()=>r(!0)}),e.jsx("main",{className:"p-4 sm:p-6 md:p-8 lg:p-12 flex-1",children:d()})]})]}),e.jsx(Os,{user:s,isOpen:l,onClose:()=>c(!1)})]})},Rs=()=>{const{currentUser:s,login:t,signup:i,logout:a,isLoading:n}=Re();return n?e.jsx("div",{className:"min-h-screen bg-slate-100"}):e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-800",children:s?e.jsx(Us,{user:s,onLogout:a}):e.jsx(os,{onLogin:t,onSignup:i})})},De=document.getElementById("root");if(!De)throw new Error("Could not find root element to mount to");const zs=Fe.createRoot(De);zs.render(e.jsx(ve.StrictMode,{children:e.jsx(Rs,{})}));
